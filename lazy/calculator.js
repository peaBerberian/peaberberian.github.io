/** This is the code for the app identified as "calculator". */
function b(n,t=1n){if(t===0n)throw new Error("Error: Division by zero!");t<0n&&(n=-n,t=-t);let o=(a,l)=>l===0n?a:o(l,a%l),i=o(n<0n?-n:n,t);return{numerator:n/i,denominator:t/i,toString(){return this.denominator===1n?this.numerator.toString():`${this.numerator}/${this.denominator}`},toDecimal(){if(this.denominator===1n)return this.numerator.toString();let a=this.numerator<0n?"-":"",l=this.numerator<0n?-this.numerator:this.numerator,s=l/this.denominator,g=l%this.denominator;if(g===0n)return a+s.toString();let m="",f=g,u=new Map,c=0;for(;f!==0n&&c<10&&!u.has(f.toString());)u.set(f.toString(),c),f*=10n,m+=(f/this.denominator).toString(),f=f%this.denominator,c++;return a+s.toString()+(m?"."+m:"")}}}function w(n,t){return b(n.numerator*t.denominator+t.numerator*n.denominator,n.denominator*t.denominator)}function D(n,t){return b(n.numerator*t.denominator-t.numerator*n.denominator,n.denominator*t.denominator)}function B(n,t){return b(n.numerator*t.numerator,n.denominator*t.denominator)}function y(n,t){if(t.numerator===0n)throw new Error("Error: A division by zero, what a mad lad! \u200B\u{1F640}\u{1F640}");return b(n.numerator*t.denominator,n.denominator*t.numerator)}function h(n){let t=n.replace(/,/g,"");if(t.includes(".")){let o=t.split("."),i=o[0]||"0",a=o[1]||"0",s=10n**BigInt(a.length),g=BigInt(i)*s+BigInt(a);return b(g,s)}return b(BigInt(t))}function F(n,t){let o="",i=null,a=null,l=!1,s="",g=document.createElement("div");E(g,{display:"flex",flexDirection:"column",width:"100%",height:"100%",backgroundColor:t.STYLE.barBg,border:"1px solid "+t.STYLE.lineColor,padding:"10px",fontFamily:"Arial, sans-serif",boxSizing:"border-box",overflow:"auto"});let m=document.createElement("div");E(m,{backgroundColor:t.STYLE.bgColor,border:"2px solid "+t.STYLE.lineColor,color:t.STYLE.textColor,padding:"10px",textAlign:"right",fontSize:"1.5em",fontFamily:"monospace",minHeight:"30px",marginBottom:"10px",overflow:"hidden",wordBreak:"break-all",flex:"0 0 auto"}),m.textContent="0",g.appendChild(m);let f=document.createElement("div");E(f,{flex:"1",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"repeat(5, 1fr)",gap:"5px"}),g.appendChild(f);function u(){s&&l?m.textContent=s:s&&!l&&s.indexOf("\u200B")===-1?m.textContent=s+o:m.textContent=o||"0"}function c(e){l?(o=e,l=!1):o=o==="0"?e:o+e,u()}function S(){l?(o="0.",l=!1):o.indexOf(".")===-1&&(o+="."),u()}function x(){o="0",i=null,a=null,l=!1,s="",u()}function p(e){let r=h(o);if(i===null)i=r,e&&(s=`${o} ${e==="*"?"\xD7":e==="/"?"\xF7":e} `,l=!0);else if(a&&!l)try{let d;switch(a){case"+":d=w(i,r);break;case"-":d=D(i,r);break;case"*":d=B(i,r);break;case"/":d=y(i,r);break;default:return}let C=d.toDecimal();o=C,i=d,e?(s=`${C} ${e==="*"?"\xD7":e==="/"?"\xF7":e} `,l=!0):s=""}catch(d){o=d.message,i=null,a=null,l=!0,s="",u();return}else if(e){let d=e==="*"?"\xD7":e==="/"?"\xF7":e;s=`${i.toDecimal()} ${d} `,l=!0}a=e,u()}function k(){if(a&&i!==null){let e=h(o);try{let r;switch(a){case"+":r=w(i,e);break;case"-":r=D(i,e);break;case"*":r=B(i,e);break;case"/":r=y(i,e);break;default:return}if(window.HANG_FOREVER&&L(e))for(;;);s=L(e)?r.toDecimal()+" \u200B(Look Ma, no rounding errors!)":"",o=r.toDecimal(),i=null,a=null,l=!0,u()}catch(r){o=r.message,i=null,a=null,l=!0,s="",u()}}}function L(e){return a!=="+"?!1:i.numerator===1n&&i.denominator===10n&&e.numerator===1n&&e.denominator===5n||e.numerator===1n&&e.denominator===10n&&i.numerator===1n&&i.denominator===5n}[{text:"C",action:x,style:{backgroundColor:t.STYLE.textColor,color:t.STYLE.bgColor}},{text:"\xB1",action:()=>{o!=="0"&&!$(o)&&(o=o.startsWith("-")?o.slice(1):"-"+o,u())}},{text:"%",action:()=>{if(o&&o!=="0"&&!$(o)){let e=h(o);o=y(e,b(100n)).toDecimal(),u()}}},{text:"\xF7",action:()=>p("/"),style:{backgroundColor:t.STYLE.primaryColor,color:t.STYLE.bgColor}},{text:"7",action:()=>c("7")},{text:"8",action:()=>c("8")},{text:"9",action:()=>c("9")},{text:"\xD7",action:()=>p("*"),style:{backgroundColor:t.STYLE.primaryColor,color:t.STYLE.bgColor}},{text:"4",action:()=>c("4")},{text:"5",action:()=>c("5")},{text:"6",action:()=>c("6")},{text:"-",action:()=>p("-"),style:{backgroundColor:t.STYLE.primaryColor,color:t.STYLE.bgColor}},{text:"1",action:()=>c("1")},{text:"2",action:()=>c("2")},{text:"3",action:()=>c("3")},{text:"+",action:()=>p("+"),style:{backgroundColor:t.STYLE.primaryColor,color:t.STYLE.bgColor}},{text:"0",action:()=>c("0"),style:{gridColumn:"span 2"}},{text:".",action:S},{text:"=",action:k,style:{fontWeight:"bold",color:t.STYLE.primaryColor,backgroundColor:t.STYLE.bgColor}}].forEach(e=>{let r=document.createElement("button");r.textContent=e.text;let d={backgroundColor:t.STYLE.bgColor,color:t.STYLE.textColor,border:"1px solid "+t.STYLE.lineColor,borderRadius:"4px",fontSize:"1.5em",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",...e.style};E(r,d),r.addEventListener("mouseenter",()=>{let C=e.style?.backgroundColor||t.STYLE.bgColor,Y=C===t.STYLE.bgColor?t.STYLE.barHoverBg:C;r.style.backgroundColor=Y,r.style.filter="brightness(0.9)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=e.style?.backgroundColor||t.STYLE.bgColor,r.style.filter="none"}),r.addEventListener("click",e.action),f.appendChild(r)});function T(e){let r=e.key;/[0-9]/.test(r)?(e.preventDefault(),c(r)):r==="."?(e.preventDefault(),S()):r==="+"?(e.preventDefault(),p("+")):r==="-"?(e.preventDefault(),p("-")):r==="*"?(e.preventDefault(),p("*")):r==="/"?(e.preventDefault(),p("/")):r==="Enter"||r==="="?(e.preventDefault(),k()):r==="Escape"||r.toLowerCase()==="c"?(e.preventDefault(),x()):r==="Backspace"&&(e.preventDefault(),o.length>1?o=o.slice(0,-1):o="0",u())}return{element:g,onActivate(){document.addEventListener("keydown",T)},onDeactivate(){document.removeEventListener("keydown",T)}}}function $(n){return n.indexOf("Error")>=0}function E(n,t){for(let o of Object.keys(t))n.style[o]=t[o]}export{F as create};
