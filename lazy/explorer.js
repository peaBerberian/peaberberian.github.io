/** This is the code for the app identified as "explorer". */
var he='<svg width="800px" height="800px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-100.000000, -1759.000000)" fill="currentColor"><g transform="translate(56.000000, 160.000000)"><path d="M62,1605.0005 L52,1605.0005 L52,1601.0005 L46,1601.0005 L46,1617.0005 L62,1617.0005 L62,1605.0005 Z M64,1603.0005 L64,1619.0005 L44,1619.0005 L44,1599.0005 L54,1599.0005 L54,1603.0005 L64,1603.0005 Z M50.473,1609.4915 L52.049,1609.2635 C52.295,1609.2275 52.508,1609.0725 52.618,1608.8495 L53.322,1607.4215 C53.461,1607.1405 53.73,1607.0005 54,1607.0005 C54.27,1607.0005 54.539,1607.1405 54.678,1607.4215 L55.382,1608.8495 C55.493,1609.0725 55.705,1609.2275 55.952,1609.2635 L57.527,1609.4915 C58.147,1609.5825 58.395,1610.3445 57.946,1610.7815 L56.806,1611.8925 C56.628,1612.0665 56.546,1612.3165 56.589,1612.5615 L56.858,1614.1305 C56.941,1614.6195 56.553,1615.0165 56.113,1615.0165 C55.997,1615.0165 55.877,1614.9885 55.761,1614.9275 L54.352,1614.1865 C54.242,1614.1285 54.121,1614.0995 54,1614.0995 C53.879,1614.0995 53.758,1614.1285 53.648,1614.1865 L52.239,1614.9275 C52.123,1614.9885 52.003,1615.0165 51.887,1615.0165 C51.447,1615.0165 51.059,1614.6195 51.142,1614.1305 L51.411,1612.5615 C51.454,1612.3165 51.372,1612.0665 51.194,1611.8925 L50.054,1610.7815 C49.605,1610.3445 49.853,1609.5825 50.473,1609.4915 L50.473,1609.4915 Z"></path></g></g></g></svg>',ce='<svg width="800px" height="800px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-376.000000, -1639.000000)" fill="currentColor"><g transform="translate(56.000000, 160.000000)"><path d="M329.0709,1497.0005 L325.9999,1497.0005 L325.9999,1494.0005 C325.9999,1493.4485 325.5519,1493.0005 324.9999,1493.0005 C324.4479,1493.0005 323.9999,1493.4485 323.9999,1494.0005 L323.9999,1497.0005 L320.9999,1497.0005 C320.4539,1497.0005 320.0079,1497.4395 319.9999,1497.9855 C319.9919,1498.5435 320.4419,1499.0005 320.9999,1499.0005 L323.9999,1499.0005 L323.9999,1502.0005 C323.9999,1502.5525 324.4479,1503.0005 324.9999,1503.0005 C325.5519,1503.0005 325.9999,1502.5525 325.9999,1502.0005 L325.9999,1499.0005 L329.0709,1499.0005 C329.6179,1499.0005 330.0629,1498.5615 330.0709,1498.0155 C330.0789,1497.4575 329.6289,1497.0005 329.0709,1497.0005 M343.9999,1485.0005 L343.9999,1497.2005 C343.9999,1498.1945 343.1789,1499.0005 342.1849,1499.0005 L332.9849,1499.0005 C332.4329,1499.0005 331.9849,1498.5525 331.9849,1498.0005 C331.9849,1497.4485 332.4329,1497.0005 332.9849,1497.0005 L341.1849,1497.0005 C341.6269,1497.0005 341.9999,1496.6425 341.9999,1496.2005 L341.9999,1486.0005 C341.9999,1485.4485 341.5379,1485.0005 340.9849,1485.0005 L333.9849,1485.0005 C332.8809,1485.0005 331.9999,1484.1045 331.9999,1483.0005 L331.9999,1481.8005 C331.9999,1481.3585 331.6269,1481.0005 331.1849,1481.0005 L326.9849,1481.0005 C326.4329,1481.0005 325.9999,1481.4485 325.9999,1482.0005 L325.9999,1490.0005 C325.9999,1490.5525 325.5519,1491.0005 324.9999,1491.0005 C324.4479,1491.0005 323.9999,1490.5525 323.9999,1490.0005 L323.9999,1481.2005 C323.9999,1479.9855 324.9699,1479.0005 326.1849,1479.0005 L331.9849,1479.0005 C333.0899,1479.0005 333.9999,1479.8955 333.9999,1481.0005 L333.9999,1481.8005 C333.9999,1482.4605 334.5249,1483.0005 335.1849,1483.0005 L341.9849,1483.0005 C343.0899,1483.0005 343.9999,1483.8955 343.9999,1485.0005"></path></g></g></g></svg>',se='<svg width="800px" height="800px" viewBox="0 -0.5 21 21" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-379.000000, -800.000000)" fill="currentColor"><g transform="translate(56.000000, 160.000000)"><path d="M327.2,654 L325.1,654 L325.1,646 L327.2,646 L327.2,644 L323,644 L323,656 L327.2,656 L327.2,654 Z M333.5,644 L333.5,646 L341.9,646 L341.9,654 L333.5,654 L333.5,656 L344,656 L344,644 L333.5,644 Z M331.4,658 L333.5,658 L333.5,660 L327.2,660 L327.2,658 L329.3,658 L329.3,642 L327.2,642 L327.2,640 L333.5,640 L333.5,642 L331.4,642 L331.4,658 Z"></path></g></g></g></svg>',oe='<svg fill="currentColor" height="800px" width="800px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 309.694 309.694" xml:space="preserve"><g><path d="M169.941,182.463l125.645,40.038c1.703,0.543,3.566,0.102,4.846-1.145c1.28-1.248,1.767-3.1,1.268-4.816   c-5.93-20.375-21.613-36.46-41.832-42.903l-103.221-32.893l-8.899-27.925c0.832-0.193,1.656-0.416,2.472-0.676   c20.449-6.517,30.154-31.434,22.095-56.726c-7.803-24.488-30.171-40.075-50.842-33.485c-19.629,6.254-30.345,30.837-22.096,56.728   c0.017,0.052,0.035,0.102,0.052,0.153l15.499,48.637l-48.583-15.481c-0.069-0.022-0.137-0.048-0.206-0.07   c-24.616-7.844-50.126,1.376-56.729,22.097c-6.516,20.449,8.193,42.781,33.485,50.841c24.63,7.848,50.126-1.384,56.727-22.095   c0.262-0.821,0.477-1.646,0.671-2.472l27.929,8.899l22.001,69.042h37.483L169.941,182.463z M76.755,155.453   c-2.157,6.771-14.017,10.517-26.572,6.515c-13.105-4.176-19.955-14.255-17.905-20.688c2.154-6.763,14.004-10.52,26.574-6.516   C71.957,138.94,78.805,149.019,76.755,155.453z M128.76,44.799c6.577-2.101,16.574,4.996,20.688,17.905   c4.176,13.104-0.082,24.521-6.515,26.571c-6.595,2.106-16.585-5.024-20.688-17.903C118.267,58.891,121.972,46.962,128.76,44.799z    M151.869,164.391c-3.945,3.945-10.343,3.945-14.288,0c-3.946-3.946-3.946-10.343,0-14.289c3.945-3.945,10.343-3.945,14.288,0   C155.816,154.048,155.816,160.444,151.869,164.391z"/><path d="M56.5,264.278H19.904H12.5c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5h7.404H56.5   c6.903,0,12.5-5.597,12.5-12.5C69,269.875,63.403,264.278,56.5,264.278z"/><path d="M136.732,264.278h-44c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5h44c6.903,0,12.5-5.597,12.5-12.5   C149.232,269.875,143.635,264.278,136.732,264.278z"/><path d="M216.963,264.278h-44c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5h44c6.903,0,12.5-5.597,12.5-12.5   C229.463,269.875,223.866,264.278,216.963,264.278z"/><path d="M301.893,265.199c-1.451-0.589-3.035-0.921-4.698-0.921h-44c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5   h44c1.663,0,3.247-0.332,4.698-0.921c4.573-1.858,7.802-6.339,7.802-11.579C309.694,271.538,306.466,267.058,301.893,265.199z"/></g></svg>',de='<svg fill="currentColor" height="800px" width="800px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><g><g><path d="M372.87,203.208v-19.556c0-27.618-22.469-50.087-50.087-50.087h-5.126L271.633,10.833C269.19,4.317,262.959,0,256,0    s-13.19,4.318-15.633,10.833l-46.024,122.732h-5.126c-27.618,0-50.087,22.469-50.087,50.087v19.556    c-19.435,6.89-33.391,25.459-33.391,47.226v211.478c0,27.618,22.469,50.087,50.087,50.087h200.348    c27.618,0,50.087-22.469,50.087-50.087c0-10.662,0-203.035,0-211.478C406.261,228.667,392.304,210.099,372.87,203.208z     M256,64.245l25.995,69.32h-51.99L256,64.245z M372.87,411.826h-83.478V300.522h83.478V411.826z M372.87,267.13h-83.478    c-18.412,0-33.391,14.979-33.391,33.391v111.304c0,18.412,14.979,33.391,33.391,33.391h83.478v16.696    c0,9.206-7.49,16.696-16.696,16.696H155.826c-9.206,0-16.696-7.49-16.696-16.696V250.435c0-9.206,7.49-16.696,16.696-16.696    h66.783c9.22,0,16.696-7.475,16.696-16.696c0-9.22-7.475-16.696-16.696-16.696h-50.087v-16.696c0-9.206,7.49-16.696,16.696-16.696    c15.332,0,118.223,0,133.565,0c9.206,0,16.696,7.49,16.696,16.696v16.696h-50.087c-9.22,0-16.696,7.475-16.696,16.696    c0,9.22,7.475,16.696,16.696,16.696h66.783c9.206,0,16.696,7.49,16.696,16.696V267.13z"/></g></g></svg>';function R(e,n){Z(e,"\u274C "+n,5e3)}function Y(...e){if(e.length===0)return"";let n=e[0];for(let o=1;o<e.length;o++){let r=e[o];r.startsWith("/")?n=r:n.endsWith("/")?n+=r:n+="/"+r}return n}function ge(e){let n=e.lastIndexOf(".");return n===-1?"":e.slice(n+1).toLowerCase()}function ve({extension:e,icon:n}){return n||{txt:"\u{1F4C4}",md:"\u{1F4DD}",html:"\u{1F310}",css:"\u{1F3A8}",js:"\u{1F4DC}",json:"\u{1F4CB}",pdf:"\u{1F4D1}",webp:"\u{1F5BC}\uFE0F",jpg:"\u{1F5BC}\uFE0F",avif:"\u{1F5BC}\uFE0F",heif:"\u{1F5BC}\uFE0F",jpeg:"\u{1F5BC}\uFE0F",png:"\u{1F5BC}\uFE0F",gif:"\u{1F5BC}\uFE0F",svg:"\u{1F5BC}\uFE0F",mp3:"\u{1F3B5}",mp4:"\u{1F3AC}",webm:"\u{1F3AC}",mkv:"\u{1F3AC}",avi:"\u{1F3AC}",zip:"\u{1F4E6}",tar:"\u{1F4E6}",rar:"\u{1F4E6}",gz:"\u{1F4E6}",doc:"\u{1F4D8}",docx:"\u{1F4D8}",xls:"\u{1F4CA}",xlsx:"\u{1F4CA}",ppt:"\u{1F4CA}",pptx:"\u{1F4CA}",csv:"\u{1F4CA}",run:"\u{1F680}"}[e]||"\u{1F4C4}"}function h(e,n){for(let o of Object.keys(n))e.style[o]=n[o]}function X(e){h(e,{backgroundColor:"var(--sidebar-bg-color)",color:"var(--sidebar-hover-bg)",border:"1px solid var(--window-line-color)",cursor:"auto",transform:"none",pointerEvents:"none"}),e.setAttribute("disabled","disabled"),e.setAttribute("tabindex","-1")}function ee(e){h(e,{backgroundColor:"var(--sidebar-selected-bg-color)",color:"var(--sidebar-selected-text-color)",border:"1px solid var(--sidebar-selected-bg-color)",cursor:"pointer",transform:"",pointerEvents:"auto"}),e.removeAttribute("disabled"),e.setAttribute("tabindex","0")}function ye(e){let n=["B","KB","MB","GB","TB"],o=0;for(;e>=1e3&&o<n.length-1;)e/=1e3,o++;return Math.round(e*100)/100+" "+n[o]}function pe(e,n){let o=()=>e.abort();n.addEventListener("abort",o),e.signal.addEventListener("abort",()=>{n.removeEventListener("abort",o)})}function Z(e,n,o=5e3){let r=document.createElement("div");r.textContent=n,r.style.position="absolute",r.style.top="10px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.backgroundColor="rgba(0, 0, 0, 0.8)",r.style.color="white",r.style.padding="10px 20px",r.style.borderRadius="4px",r.style.zIndex="1000",r.style.transition="opacity 0.3s",e.appendChild(r),setTimeout(()=>{r.style.opacity="0",setTimeout(()=>{r.remove()},350)},o)}function ue({entries:e,path:n,contextMenuBase:o,callbacks:{setUpContextMenu:r,navigateTo:a,openFiles:l,onSelectionChange:c,escape:f,deleteItems:w,cutItems:E,pasteItems:k},abortSignal:x}){let I=document.createElement("div");h(I,{top:"0px",left:"0px",minHeight:"100%",minWidth:"100%"});let L=new Map,s={items:[],elements:new Set},g={element:null,timeStamp:-1/0},d=!1,W=null,D=document.createElement("div");h(D,{display:"grid",gridTemplateColumns:"repeat(auto-fill, 100px)",gap:"5px",overflowX:"hidden",justifyContent:"space-evenly"}),I.appendChild(D),r({element:I,filter:t=>I===t.target||D===t.target,abortSignal:x,actions:o});let v=be(e,n);if(v.length===0){let t=ke(n);return I.appendChild(t),{element:I,onActivate:B,onDeactivate:A,signalCutAction:u,selectItems:()=>{}}}for(let t of v){let b=function({includePath:z,toggle:ie,keepPrevious:re,clickBehavior:te}){if(z){let J=[...s.elements].pop();if(J&&J!==i){let T=-1,G=-1,ne=D.children;for(let U=0;U<ne.length;U++)ne[U]===J?G=U:ne[U]===i&&(T=U);if(T>=0&&G>=0){let U=T>G?[...D.children].slice(G,T+1):[...D.children].slice(T,G+1);F(U,{clearPrevious:!1});return}}}j(i,t,{toggle:ie,keepPrevious:re,clickBehavior:te})},i=document.createElement("div");i.tabIndex="0",i.onfocus=()=>{if(!S(i)||H().size>1?i.className="emphasis-focus":i.className="",i.dataset.ignoreNextFocusEvent){delete i.dataset.ignoreNextFocusEvent;return}},i.style.outlineColor="var(--sidebar-selected-bg-color)",h(i,{display:"flex",gap:"5px",flexDirection:"column",alignItems:"center",padding:"5px",margin:"5px",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s, color 0.2s"}),r({element:i,filter:z=>i.contains(z.target),abortSignal:x,actions:[{name:"open",title:"Open this "+(t.isDirectory?"directory":"file"),onClick:()=>{t.isDirectory?a(t.path):l([t])}},{name:"clear",title:"Delete this "+(t.isDirectory?"directory":"file"),height:"1.4em",onClick:()=>{w([t])}},{name:"cut",height:"1.4em",svg:oe,title:"Cut "+(t.isDirectory?"directory":"file"),onClick:()=>{E([t])}},{name:"separator"},...o]});let y=document.createElement("div");y.innerHTML=t.isDirectory?"\u{1F4C1}":ve(t),h(y,{fontSize:"3em",marginBottom:"5px"});let p=document.createElement("div");p.textContent=t.name.replace(/\./g,"\u200B."),h(p,{textAlign:"center",width:"100%",flexGrow:"1",overflow:"hidden",whiteSpace:"normal",wordBreak:"break-word",display:"flex",justifyContent:"center"}),i.appendChild(y),i.appendChild(p),i.onmousedown=z=>{z.preventDefault()},i.ontouchstart=()=>{b({toggle:!0,keepPrevious:!0,includePath:!1})},i.onclick=z=>{b({toggle:z.ctrlKey,keepPrevious:z.pointerType==="touch"?!1:z.ctrlKey,clickBehavior:z.pointerType==="touch"?"double":"single",includePath:z.shiftKey})},i.onselectstart=z=>z.preventDefault(),L.set(i,t),D.appendChild(i)}return W=L.size>0?Ee(I,L,{getSelectedItems:()=>[...H()],selectItemElts:F,clearItemElts:$,isItemEltSelected:S}):null,{element:I,onActivate:()=>{d=!0,B()},onDeactivate:()=>{d=!1,A()},signalCutAction:u,selectItems:t=>{let i=L.entries().reduce((y,[p,b])=>(t.some(z=>z.path===b.path)&&y.push(p),y),[]);F(i,{})}};function j(t,i,{toggle:y,keepPrevious:p,clickBehavior:b}){if(b==="double"||b==="single"){if(b==="double"||g.element===t&&performance.now()-g.timeStamp<=500){i.isDirectory?a(i.path):l([i]);return}g.element=t,g.timeStamp=performance.now()}y?S(t)?$([t]):F([t],{clearPrevious:!p}):(F([t],{clearPrevious:!p}),c(s.items))}function u(t){L.entries().forEach(([i,y])=>{t.some(p=>p.path===y.path)?i.style.opacity="0.6":i.style.opacity=""},{})}function F(t,{clearPrevious:i,preventScroll:y}){if(i){for(let b of s.elements)b.style.backgroundColor="",b.style.color="";s.elements.clear(),s.items.length=0}for(let b of t){let z=L.get(b);z&&!S(b)&&(s.elements.add(b),s.items.push(z),b.style.backgroundColor="var(--sidebar-selected-bg-color)",b.style.color="var(--sidebar-selected-text-color)")}let p=t[t.length-1];d&&p&&document.activeElement!==p&&(p.dataset.ignoreNextFocusEvent=!0,p.focus({preventScroll:y})),c(s.items)}function S(t){return s.elements.has(t)}function B(){W?.onActivate(),document.addEventListener("keydown",N)}function A(){W?.onDeactivate(),document.removeEventListener("keydown",N)}function N(t){switch(t.key){case"Escape":{t.preventDefault(),f();break}case"Delete":{t.preventDefault(),w(s.items);break}case"Backspace":{t.preventDefault(),M();break}case"ArrowLeft":{if(t.preventDefault(),s.items.length===0){let p=D.children[0];p&&F([p],{clearPrevious:!t.ctrlKey&&!t.shiftKey});return}let i=L.has(document.activeElement)?document.activeElement:[...s.elements].pop();if(!i)break;let y=i.previousElementSibling;y?F([y],{clearPrevious:!t.ctrlKey&&!t.shiftKey}):F([i],{clearPrevious:!t.ctrlKey&&!t.shiftKey});break}case"ArrowRight":{if(t.preventDefault(),s.items.length===0){let p=D.children[0];p&&F([p],{clearPrevious:!t.ctrlKey&&!t.shiftKey});return}let i=L.has(document.activeElement)?document.activeElement:[...s.elements].pop();if(!i)break;let y=i.nextElementSibling;y?F([y],{clearPrevious:!t.ctrlKey&&!t.shiftKey}):F([i],{clearPrevious:!t.ctrlKey&&!t.shiftKey});break}case"ArrowDown":{if(t.preventDefault(),s.items.length===0){let b=D.children[0];b&&F([b],{clearPrevious:!t.ctrlKey&&!t.shiftKey});return}let i=L.has(document.activeElement)?document.activeElement:[...s.elements].pop();if(!i)break;let y=i.getBoundingClientRect(),p=i.nextElementSibling;for(;p;){if(p.getBoundingClientRect().left===y.left){F([p],{clearPrevious:!t.ctrlKey&&!t.shiftKey});break}p=p.nextElementSibling}break}case"ArrowUp":{if(t.preventDefault(),s.items.length===0){let b=D.children[0];b&&F([b],{clearPrevious:!t.ctrlKey&&!t.shiftKey});return}let i=L.has(document.activeElement)?document.activeElement:[...s.elements].pop();if(!i)break;let y=i.getBoundingClientRect(),p=i.previousElementSibling;for(;p;){if(p.getBoundingClientRect().left===y.left){F([p],{clearPrevious:!t.ctrlKey&&!t.shiftKey});break}p=p.previousElementSibling}break}case" ":if(t.preventDefault(),L.has(document.activeElement)){let i=L.get(document.activeElement);j(document.activeElement,i,{toggle:!0,keepPrevious:!0});break}case"Enter":{if(t.preventDefault(),s.items.length===0)return;if(s.items.length===1){let i=s.items[0];i.isDirectory?a(i.path):l([i])}else{let i=[];for(let y of s.items){if(y.isDirectory)return;i.push(y)}l(i)}break}case"a":t.ctrlKey&&(t.preventDefault(),t.preventDefault(),s.elements.clear(),s.items.length=0,g.element=null,g.timeStamp=-1/0,F(D.children,{clearPrevious:!0}),c(s.items));break;case"x":t.ctrlKey&&(t.preventDefault(),t.preventDefault(),E(s.items));break;case"v":t.ctrlKey&&(t.preventDefault(),t.preventDefault(),k());break}}function $(t){for(let i of t){let y=L.get(i);if(y){let p=s.items.indexOf(y);p>=0&&s.items.splice(p,1)}if(s.elements.delete(i),i.style.backgroundColor="",i.style.color="",document.activeElement===i){i.blur();let p=[...s.elements].pop();d&&p&&document.activeElement!==p&&(p.dataset.ignoreNextFocusEvent=!0,p.focus({preventScroll:!0}))}}c(s.items)}function H(){return s.elements}function M(){n!=="/"&&(n[n.length-1]==="/"&&(n=n.substring(0,n.length-1)),a(n.substring(0,n.lastIndexOf("/")+1)))}}function be(e,n){let o=e.map(r=>{let a=Y(n,r.name);return{name:r.name,icon:r.type==="directory"?"\u{1F4C1}":r.icon,path:a,isDirectory:r.type==="directory",size:r.size,mtime:r.modified&&new Date(r.modified),extension:ge(r.name)}});return o.sort((r,a)=>r.isDirectory&&!a.isDirectory?-1:!r.isDirectory&&a.isDirectory?1:r.name.localeCompare(a.name)),o}function ke(e){let n=document.createElement("div");return n.style.padding="30px",n.style.textAlign="center",n.style.color="var(--window-text-color)",e==="/userdata/"||e==="/userdata"?n.innerHTML="You do not have anything stored in your user directory yet.<br><br><i>Start by uploading or saving some files in it first!</i><br><br><br><b>Files uploaded and saved here still stay on your computer, they are not sent to a server.</b>":n.textContent="There's nothing in this directory (yet!)",n}function Ee(e,n,{getSelectedItems:o,selectItemElts:r,clearItemElts:a,isItemEltSelected:l}){let c=!1,f=!1,w=0,E=0,k=[],x=document.createElement("div");x.className="selection-box",Object.assign(x.style,{position:"absolute",left:`${w}px`,top:`${E}px`,width:"0",height:"0",opacity:.5,backgroundColor:"var(--app-primary-color)",border:"",pointerEvents:"none",zIndex:"1000"}),e.addEventListener("mousedown",d=>{d.button===0&&(d.preventDefault(),c=!0,f=!1,w=d.clientX,E=d.clientY,k=o(),!d.shiftKey&&!d.ctrlKey&&!k.some(W=>W.contains(d.target))&&a(k),document.body.appendChild(x))}),e.addEventListener("selectstart",d=>{d.preventDefault()});function I(d){if(!c)return;let W=d.clientX,D=d.clientY,v=e.parentElement.getBoundingClientRect(),j=0,u=Math.min(w,W);u<v.left&&(j=u-v.left,u=v.left);let F=0,S=Math.min(E,D);S<v.top&&(F=S-v.top,S=v.top);let B=Math.abs(W-w)+j;u+B>v.right&&(B=v.right-u);let A=Math.abs(D-E)+F;if(S+A>v.bottom&&(A=v.bottom-S),x.style.left=`${u}px`,x.style.top=`${S}px`,x.style.width=`${B}px`,x.style.height=`${A}px`,!f){if(Math.abs(w-W)<15||Math.abs(E-D)<15)return;f=!0,!d.ctrlKey&&!d.shiftKey&&a(o())}let N=x.getBoundingClientRect(),$=[],H=[];n.keys().forEach(M=>{if(!n.get(M))return;let i=M.getBoundingClientRect(),y=!(N.right<i.left||N.left>i.right||N.bottom<i.top||N.top>i.bottom);if(d.ctrlKey&&k.includes(M))y?H.push(M):$.push(M);else if(y){if(l(M))return;$.push(M)}else H.push(M)}),r($,{clearPrevious:!1,preventScroll:!0}),a(H)}function L(){if(c){f=!1,k=[],c=!1,x.style.left="0",x.style.top="0",x.style.width="0",x.style.height="0";try{document.body.removeChild(x)}catch{}}}return{onActivate:s,onDeactivate:g};function s(){document.addEventListener("mousemove",I),document.addEventListener("mouseup",L),document.addEventListener("mouseleave",L)}function g(){L(),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",L),document.removeEventListener("mouseleave",L)}}function xe(e,n){return new Promise((o,r)=>{let a=document.createElement("input");a.style.display="none",a.type="file",a.multiple=!0,a.click(),a.addEventListener("cancel",async()=>{o([])}),a.addEventListener("error",async()=>{r(new Error("Failed to get files from your computer."))}),a.addEventListener("change",async l=>{let c=l.target.files;c.length===0&&o([]);try{let f=[];for(let w of c){f.push(w.name);let E=Y(n,w.name),k=await w.arrayBuffer();await e.writeFile(E,k)}o(f)}catch(f){r(new Error(`Failed to upload file: ${f.message}`))}})})}async function me(e,n,o,r=""){return new Promise(a=>{let l=document.createElement("div");h(l,{position:"absolute",inset:"0px",backgroundColor:"var(--window-content-bg)",opacity:"0.5",zIndex:"2",height:"100%",width:"100%"}),e.appendChild(l);let c=document.createElement("input");c.type="text",c.value=r,h(c,{width:"100%",padding:"8px",marginBottom:"15px"});let f=document.createElement("button");f.className="btn",f.textContent="Cancel",h(f,{margin:"5px",padding:"4px 15px",fontSize:"1.1em",fontWeight:"bold"});let w=document.createElement("button");w.className="btn",w.textContent="OK",h(w,{margin:"5px",padding:"4px 15px",fontSize:"1.1em",fontWeight:"bold"}),X(w);let E=document.createElement("h3");h(E,{color:"var(--app-primary-color)",marginTop:"0",marginBottom:"15px"}),E.textContent=n;let k=document.createElement("p");h(k,{marginBottom:"15px"}),k.textContent=o;let x=document.createElement("div");h(x,{boxShadow:"0 -2px 10px rgba(0, 0, 0, 0.3)",position:"relative",padding:"20px",border:"1px solid var(--window-line-color)",zIndex:"3",backgroundColor:"var(--window-content-bg)",top:"50%",transform:"translateY(-50%)",maxWidth:"90%",width:"35em",margin:"auto"}),x.appendChild(E),x.appendChild(k),x.appendChild(c);let I=document.createElement("div");h(I,{display:"flex",justifyContent:"flex-end"}),I.appendChild(f),I.appendChild(w),x.appendChild(I),e.appendChild(x),c.focus(),c.select(),w.addEventListener("click",L),f.addEventListener("click",s),c.oninput=()=>{c.value?ee(w):X(w)},c.addEventListener("keydown",g=>{g.key==="Enter"&&L(),g.key==="Escape"&&s()}),l.onclick=()=>a(null);function L(){l.remove(),x.remove(),a(c.value)}function s(){l.remove(),x.remove(),a(null)}})}async function ae(e,n,o){return new Promise(r=>{let a=document.createElement("div");h(a,{position:"absolute",inset:"0px",backgroundColor:"var(--window-content-bg)",opacity:"0.5",zIndex:"2",height:"100%",width:"100%"}),e.appendChild(a);let l=document.createElement("button");l.className="btn",l.textContent="No",h(l,{margin:"5px",padding:"4px 15px",fontSize:"1.1em",fontWeight:"bold"});let c=document.createElement("button");c.className="btn",c.textContent="Yes",h(c,{margin:"5px",padding:"4px 15px",fontSize:"1.1em",fontWeight:"bold"}),ee(c);let f=document.createElement("h3");h(f,{color:"var(--app-primary-color)",marginTop:"0",marginBottom:"15px"}),f.textContent=n;let w=document.createElement("div");h(w,{marginBottom:"10px"}),w.textContent=o;let E=document.createElement("div");h(E,{boxShadow:"0 -2px 10px rgba(0, 0, 0, 0.3)",position:"relative",padding:"20px",border:"1px solid var(--window-line-color)",zIndex:"3",backgroundColor:"var(--window-content-bg)",top:"50%",transform:"translateY(-50%)",maxWidth:"90%",width:"35em",margin:"auto"}),E.appendChild(f),E.appendChild(w);let k=document.createElement("div");h(k,{display:"flex",justifyContent:"center"}),k.appendChild(l),k.appendChild(c),E.appendChild(k),e.appendChild(E),c.addEventListener("click",x),l.addEventListener("click",I),a.onclick=()=>r(null),c.focus();function x(){a.remove(),E.remove(),r(!0)}function I(){a.remove(),E.remove(),r(!1)}})}function $e(e=[],n,o){return fe("explorer",e,n,o)}function Oe(e={},n,o){return fe("opener",e,n,o)}function He(e={},n,o){return fe("saver",e,n,o)}function fe(e,n,o,r){let{appUtils:a,filesystem:l}=o,c={};for(let m of n)m.type==="options"&&(c=m);let{title:f,baseDirectory:w="/userdata/",savedFileName:E="new_file.txt",savedFileData:k,allowMultipleSelections:x=!0,confirmValue:I=e==="opener"?"Open":"Save"}=c,L=document.createElement("div");h(L,{display:"flex",flexDirection:"column",position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:"var(--window-content-bg)"});let s=new AbortController;pe(s,r);let g=w.endsWith("/")?w:w+"/",d=Ae();f&&d.appendChild(Me(f));let W=Ce(g,i);d.appendChild(W);let D=[],v=[],j=!1,u,{element:F,enableButton:S,disableButton:B}=a.constructAppHeaderLine([...e!=="explorer"?[{name:"undo",title:"Exit picker",onClick:()=>{e==="saver"?o.onSaved(null):o.onOpen([])}},{name:"separator"}]:[],{name:"previous",height:"1em",title:"Parent Directory",onClick:()=>y()},{name:"home",height:"1em",title:"Home Directory",svg:he,onClick:()=>i("/userdata/")},{name:"separator"},{name:"upload",title:"Load Files",onClick:b},{name:"download",title:"Download file",onClick:z},{name:"separator"},{name:"newDir",height:"1em",title:"New Directory",svg:ce,onClick:ie},{name:"clear",height:"1em",title:"Delete item(s)",onClick:()=>p(v)},{name:"rename",height:"1em",title:"Rename item",svg:se,onClick:re},{name:"separator"},{name:"cut",height:"1em",title:"Cut (selection)",svg:oe,onClick:()=>te(v)},{name:"paste",height:"1em",title:"Paste",svg:de,onClick:J}]);B("paste"),d.appendChild(F);let A=document.createElement("div");h(A,{position:"relative",flex:"1",minHeight:"150px",backgroundColor:"var(--window-content-bg)",border:"1px solid var(--window-line-color)"});let N=document.createElement("div");h(N,{overflow:"auto",height:"100%"}),A.appendChild(N),d.appendChild(A);let $=document.createElement("div");h($,{padding:"5px",backgroundColor:"#efef00",marginTop:"-5px",color:"#000",display:"none"}),$.textContent="This directory is read-only, you cannot add nor remove files from it.",d.appendChild($);let H=document.createElement("div");h(H,{display:"flex",gap:"5px",justifyContent:"space-between",alignItems:"center"});let M;e==="saver"?(M=document.createElement("input"),M.type="text",M.value=E,M.onkeydown=m=>{m.stopPropagation(),m.key==="Enter"&&(m.preventDefault(),t.click())},h(M,{flex:"1",padding:"5px 8px",border:"1px solid var(--window-line-color)",fontWeight:"bold",fontSize:"1.1em",color:"var(--app-primary-color)"})):M=document.createElement("div"),H.appendChild(M);let t=null;if(e==="opener"||e==="saver"){let m=document.createElement("div");h(m,{display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"flex-end"});let C=document.createElement("button");C.className="btn",C.textContent="Cancel",h(C,{padding:"4px 15px",fontSize:"1.1em",fontWeight:"bold"}),C.onclick=()=>{e==="saver"?o.onSaved(null):o.onOpen([])},t=document.createElement("button"),t.className="btn",t.textContent=I,t.onclick=async()=>{if(e==="opener")o.onOpen(v.map(P=>P.path));else if(!M.value)R(A,"No file name entered.");else{u?.onDeactivate();let P=q(d);try{let O=Y(g,M.value);try{if(await l.stat(O),!await ae(P,"Are you sure?",`You're going to overwrite "${O}"`)){K(P,d),u.onActivate();return}}catch{}await l.writeFile(O,k),u?.onActivate(),K(P,d),o.onSaved({path:O})}catch(O){u?.onActivate(),K(P,d),R(A,O.toString())}}},h(t,{padding:"4px 15px",fontSize:"1.1em",fontWeight:"bold"}),X(t),m.appendChild(C),m.appendChild(t),H.appendChild(m)}return d.appendChild(H),L.appendChild(d),i(g),{element:L,onActivate:()=>{j=!0,u?.onActivate()},onDeactivate:()=>{j=!1,u?.onDeactivate()}};async function i(m,C){try{let P=m.endsWith("/")?m:m+"/",O=await l.readDir(P);if(s.signal.aborted)return;u?.onDeactivate(),s.abort(),s=new AbortController,pe(s,r),V(P)?$.style.display="none":$.style.display="block",g=P,v=[];let Q=Ce(P,i);W.replaceWith(Q),W=Q,T(g,v),u=ue({entries:O,path:P,contextMenuBase:U(),callbacks:{setUpContextMenu:a.setUpContextMenu,navigateTo:i,escape:G,deleteItems:p,cutItems:te,pasteItems:J,onSelectionChange:_=>{v=_,we(e,M,_),T(g,v)},openFiles:ne},abortSignal:s.signal}),D.length>0&&u.signalCutAction(D),N.innerHTML="",N.appendChild(u.element),C||N.scrollTo(0,0),j?u.onActivate():u.onDeactivate(),l.watch(P,async()=>{let _=v;await i(g,!0),u?.selectItems(_)},s.signal)}catch(P){R(A,`Error loading directory: ${P.message}`)}we(e,M,[])}function y(){g!=="/"&&(g[g.length-1]==="/"&&(g=g.substring(0,g.length-1)),i(g.substring(0,g.lastIndexOf("/")+1)))}async function p(m){m.length!==0&&(u?.onDeactivate(),await Be(l,m,d,A),u?.onActivate())}function b(){u?.onDeactivate();let m=q(d);xe(l,g).then(C=>{u?.onActivate(),K(m,d),C.length>0&&(C.length===1?Z(A,"File uploaded successfully"):Z(A,`${C.length} files uploaded successfully`))},C=>{u?.onActivate(),K(m,d),R(A,C.message)})}function z(){if(v.length===0)return;u?.onDeactivate();let m=q(d),{name:C,path:P}=v[0];return l.readFile(P,"arraybuffer").then(O=>{let Q=new Blob([O],{type:"application/octet-stream"}),_=URL.createObjectURL(Q),le=document.createElement("a");le.href=_,le.download=C,le.style.display="none",le.click(),setTimeout(()=>{URL.revokeObjectURL(_)},100),u?.onActivate(),K(m,d)},O=>{R(A,`Failed to create download: ${O.message}`)})}async function ie(){u?.onDeactivate(),await Le(l,g,d,A),u?.onActivate()}async function re(){v.length!==0&&(u?.onDeactivate(),await De(l,g,v[0].name,v[0].isDirectory,d,A),u?.onActivate())}function te(m){D=[...m],S("paste"),u?.signalCutAction(D)}function J(){B("paste"),u?.onDeactivate(),Se(l,D,g,A).then(()=>{D=[],u?.signalCutAction(D),u?.onActivate()},m=>{u?.onActivate(),D.length>0&&S("paste"),R(A,`Failed to create paste: ${m.message}`)})}function T(m,C){e==="saver"&&(V(m)?ee(t):X(t)),C.length===0?(B("cut"),B("clear"),B("rename"),B("download")):C.length===1?(V(m)?(S("cut"),S("rename"),S("clear")):(B("cut"),B("rename"),B("clear")),C[0].isDirectory?B("download"):S("download")):(V(m)?(S("cut"),S("clear")):(B("cut"),B("clear")),B("rename"),B("download")),m==="/"?B("previous"):S("previous"),V(m)?(m==="/userdata/"?B("home"):S("home"),S("newDir"),S("newFile"),S("upload")):(S("home"),B("newDir"),B("newFile"),B("upload")),e==="opener"&&t&&(C.length===0||C.some(P=>P.isDirectory)?X(t):!x&&C.length>1?X(t):ee(t))}function G(){e==="opener"?o.onOpen([]):e==="saver"?o.onSaved(null):i(g)}async function ne(m){switch(e){case"saver":{if(m.length>1){R(A,"Choose only one file to replace.");return}u?.onDeactivate();let C=q(d);try{if(!await ae(C,"Are you sure?",`You're going to overwrite "${m[0].name}"`)){K(C,d),u.onActivate();return}await l.writeFile(m[0].path,k),u?.onActivate(),K(C,d),o.onSaved({path:m[0].path})}catch(P){u?.onActivate(),K(C,d),R(A,P.toString())}break}case"opener":{e==="opener"&&!x&&m.length>1&&R(A,"Choose only one file to open."),o.onOpen(m.map(C=>C.path));break}default:{o.open(m.map(C=>C.path));break}}}function U(){return[{name:"upload",title:"Load Files",filter:()=>V(g),onClick:b},{name:"newDir",height:"1.4em",title:"New Directory",svg:ce,filter:()=>V(g),onClick:ie},{name:"separator",filter:()=>V(g)},{name:"rename",height:"1em",title:"Rename selection",svg:se,filter:()=>v.length===1,onClick:re},{name:"download",title:"Download selection",filter:()=>v.length===1&&!v[0].isDirectory,onClick:z},{name:"clear",title:"Delete current selection",filter:()=>v.length>0,onClick:()=>{p(v)}},{name:"cut",svg:oe,height:"1.4em",title:"Cut current selection",filter:()=>v.length>0,onClick:()=>{te(v)}},{name:"separator",filter:()=>v.length>0},{name:"paste",svg:de,title:"Paste cut items",height:"1em",filter:()=>D.length>0,onClick:()=>{J()}},{name:"retry",title:"Refresh directory",onClick:async()=>{let m=v;await i(g,!0),u?.selectItems(m)}},{name:"previous",title:"Go to previous directory",filter:()=>g!=="/",onClick:()=>{y()}}]}}function we(e,n,o){if(e==="saver"){o.length===1&&!o[0].isDirectory&&(n.value=o[0].name);return}if(o.length===0){n.innerHTML="0 item selected";return}let r,a=o.reduce((l,c)=>l+c.size,0);o.length===1?r="1 item selected":r=`${o.length} items selected`,n.innerHTML=r+(a>0?` <i>(${ye(a)})</i>`:"")}async function Le(e,n,o,r){let a=q(o);try{let l=await me(a,"New Directory","Enter new directory name:");if(!l){K(a,o);return}let c=Y(n,l);await e.mkdir(c.endsWith("/")?c:c+"/"),K(a,o),Z(r,`Directory "${l}" created successfully`)}catch(l){K(a,o),R(r,`Failed to create directory: ${l.message}`)}}async function De(e,n,o,r,a,l){let c=q(a);try{let f=await me(c,"Renaming "+(r?"directory":"file"),"Enter the new name wanted:",o);if(!f){K(c,a);return}await e.mv(Y(n,o)+(r?"/":""),Y(n,f)+(r?"/":"")),K(c,a),r?Z(l,"Directory renamed successfully"):Z(l,"File renamed successfully")}catch(f){K(c,a),r?R(l,`Failed to rename directory: ${f.message}`):R(l,`Failed to rename file: ${f.message}`)}}async function Se(e,n,o,r){let a=o.endsWith("/")?o:o+"/";try{for(let l of n)if(l.isDirectory){let c=l.path.endsWith("/")?l.path:l.path+"/";await e.mv(c,a+l.name)}else await e.mv(l.path,a);Z(r,"Files moved successfully")}catch(l){R(r,`Failed to move files: ${l.message}`)}}async function Be(e,n,o,r){let a=q(o);try{let l="You will delete ";if(n.length===1?l+=`"${n[0].name}"`:l+=`${n.length} items from this directory.`,!await ae(a,"Are you sure?",l)){K(a,o);return}for(let f of n)f.isDirectory?f.path==="/system32/"||f.path==="/system32"?R(r,"I'm sorry, Dave. I'm afraid I can't do that \u{1F9BE}"):await e.rmDir(f.path):await e.rmFile(f.path);K(a,o)}catch(l){K(a,o),R(r,`Failed to delete: ${l.message}`)}}function Ce(e,n){let o=document.createElement("div");h(o,{flex:"0 0 auto",display:"flex",alignItems:"center",backgroundColor:"var(--window-content-bg)",borderRadius:"4px",padding:"5px 10px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflowX:"auto",whiteSpace:"nowrap",border:"1px solid var(--window-line-color)"});let a=(e||"/").split("/").filter(f=>f),l=document.createElement("span");l.textContent="/",l.onclick=()=>{n("/")},h(l,{cursor:"pointer",padding:"0 3px",color:"var(--app-primary-color)"}),o.appendChild(l);let c="";return a.forEach((f,w)=>{c+="/"+f;let E=c,k=document.createElement("span");if(k.textContent=f,k.onclick=()=>{n(E)},h(k,{cursor:"pointer",padding:"0 3px",color:"var(--app-primary-color)"}),o.appendChild(k),w===a.length-1)k.style.fontWeight="bold";else{let x=document.createElement("span");x.textContent="/",o.appendChild(x)}}),o}function Ae(){let e=document.createElement("div");return h(e,{position:"absolute",display:"flex",gap:"5px",flexDirection:"column",width:"100%",height:"100%",top:0,left:0,padding:"10px",backgroundColor:"var(--window-sidebar-bg)",zIndex:"101",overflow:"auto"}),e}function Me(e){let n=document.createElement("div");return n.textContent=e,h(n,{flex:"0 0 auto",fontWeight:"bold",fontStyle:"italic",marginBottom:"5px"}),n}function q(e){let n=document.createElement("div");h(n,{position:"absolute",top:"0",left:"0",height:"100%",width:"100%"});for(let o of e.children)o.setAttribute("inert",!0);return e.appendChild(n),n}function K(e,n){e.remove();for(let o of n.children)o.removeAttribute("inert")}function V(e){return e.startsWith("/userdata/")||e.startsWith("/userconfig/")}export{$e as create,Oe as createFileOpener,He as createFileSaver};
