/** This is the code for the app identified as "image-viewer". */
var ee='<svg style="transform: scale(-1, 1)" width="800px" height="800px" viewBox="-1 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-342.000000, -7080.000000)" fill="currentColor"><g transform="translate(56.000000, 160.000000)"><path d="M300.002921,6930.85894 C299.524118,6934.16792 296.32507,6936.61291 292.744585,6935.86392 C290.471022,6935.38792 288.623062,6933.55693 288.145263,6931.29294 C287.32919,6927.42196 290.007276,6923.99998 294.022397,6923.99998 L294.022397,6925.99997 L299.041299,6922.99998 L294.022397,6920 L294.022397,6921.99999 C289.003495,6921.99999 285.16002,6926.48297 286.158782,6931.60494 C286.767072,6934.72392 289.294592,6937.23791 292.425383,6937.8439 C297.170253,6938.7619 301.37007,6935.51592 301.990406,6931.12594 C302.074724,6930.52994 301.591905,6929.99995 300.988633,6929.99995 L300.989637,6929.99995 C300.490758,6929.99995 300.074189,6930.36694 300.002921,6930.85894"></path></g></g></g></svg>',te='<svg style="transform: scale(1, 1)" width="800px" height="800px" viewBox="-1 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-342.000000, -7080.000000)" fill="currentColor"><g transform="translate(56.000000, 160.000000)"><path d="M300.002921,6930.85894 C299.524118,6934.16792 296.32507,6936.61291 292.744585,6935.86392 C290.471022,6935.38792 288.623062,6933.55693 288.145263,6931.29294 C287.32919,6927.42196 290.007276,6923.99998 294.022397,6923.99998 L294.022397,6925.99997 L299.041299,6922.99998 L294.022397,6920 L294.022397,6921.99999 C289.003495,6921.99999 285.16002,6926.48297 286.158782,6931.60494 C286.767072,6934.72392 289.294592,6937.23791 292.425383,6937.8439 C297.170253,6938.7619 301.37007,6935.51592 301.990406,6931.12594 C302.074724,6930.52994 301.591905,6929.99995 300.988633,6929.99995 L300.989637,6929.99995 C300.490758,6929.99995 300.074189,6930.36694 300.002921,6930.85894"></path></g></g></g></svg>',ne='<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M10 14C10 14.5523 10.4477 15 11 15C11.5523 15 12 14.5523 12 14V12H14C14.5523 12 15 11.5523 15 11C15 10.4477 14.5523 10 14 10H12V8C12 7.44772 11.5523 7 11 7C10.4477 7 10 7.44772 10 8V10H8C7.44772 10 7 10.4477 7 11C7 11.5523 7.44772 12 8 12H10V14Z" fill="currentColor"/></svg>',oe='<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7 11C7 10.4477 7.44772 10 8 10H14C14.5523 10 15 10.4477 15 11C15 11.5523 14.5523 12 14 12H8C7.44772 12 7 11.5523 7 11Z" fill="currentColor"/></svg>',ie='<svg width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z" fill="currentColor"/></svg>';function ge(g,c,w){let{constructAppHeaderLine:S}=c.appUtils,d=document.createElement("div");L(d,{display:"flex",flexDirection:"column",position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:c.STYLE.bgColor});let X=ce();d.appendChild(X);let y=null,i=[],r=-1,f=new WeakMap,{element:O,enableButton:p,disableButton:l}=S([{name:"upload",onClick:()=>{R();let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.click(),e.addEventListener("cancel",async()=>{try{await D([])}catch(t){P(m,"\u274C "+t.toString(),5e3)}k()}),e.addEventListener("error",async()=>{k(),P(m,"\u274C Failed to open your file-picker",5e3)}),e.addEventListener("change",async t=>{let n=t.target.files;try{await D(n)}catch(a){P(m,"\u274C "+a.toString(),5e3)}k()})}},{name:"open",onClick:()=>{R(),c.filePickerOpen({title:"Open an image from files stored on this Web Desktop",allowMultipleSelections:!0}).then(e=>G(e)).then(()=>k()).catch(e=>{P(m,"\u274C "+e.toString(),5e3),k()})}},{name:"separator"},{name:"previous",height:"1.4rem",title:"Previous image",onClick:z},{name:"next",height:"1.4rem",title:"Next image",onClick:A},{name:"separator"},{name:"rotateLeft",svg:ee,height:"1.4rem",title:"Rotate left",onClick:V},{name:"rotateRight",svg:te,height:"1.4rem",title:"Rotate right",onClick:W},{name:"separator"},{name:"zoomOut",svg:oe,height:"1.6rem",title:"Zoom out",onClick:U},{name:"zoomReset",svg:ie,height:"1.6rem",title:"Reset zoom",onClick:$},{name:"zoomIn",svg:ne,height:"1.6rem",title:"Zoom in",onClick:j}]);d.appendChild(O),l("previous"),l("next"),l("rotateLeft"),l("rotateRight"),l("zoomOut"),l("zoomReset"),l("zoomIn");let m=document.createElement("div");L(m,{flex:"1",position:"relative"});let v=document.createElement("div");L(v,{flex:"1",display:"flex",position:"relative",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",height:"100%",backgroundColor:c.STYLE.disabledColor}),["dragenter","dragover","dragleave","drop"].forEach(e=>{v.addEventListener(e,t=>{t.preventDefault(),t.stopPropagation()},!1)}),["dragenter","dragover"].forEach(e=>{v.addEventListener(e,q)}),["dragleave","drop"].forEach(e=>{v.addEventListener(e,K)}),v.addEventListener("drop",async e=>{R();let n=e.dataTransfer.files;try{await D(n)}catch(a){P(m,"\u274C "+a.toString(),5e3)}k()}),m.appendChild(v),d.appendChild(m);let M=document.createElement("div");L(M,{display:"flex",justifyContent:"space-between",padding:"4px 8px",backgroundColor:c.STYLE.barBg,borderTop:c.STYLE.lineColor}),d.appendChild(M),I(),m.addEventListener("wheel",e=>{let t=i[r];if(!t)return;let n=t.imgElt,a=f.get(n);if(!a)return;e.preventDefault();let s=e.deltaY>0?-.1:.1;a.scale=Math.max(.1,Math.min(10,a.scale+s)),E(n)},{passive:!1}),m.addEventListener("dblclick",()=>{let e=i[r];e&&N(e.imgElt)}),Y();{let e=[];for(let t of g)t.type==="file"&&e.push(t);e.length>0&&G(e)}return J(),{element:d,onActivate:()=>{document.addEventListener("keydown",Z)},onDeactivate:()=>{document.removeEventListener("keydown",Z)}};function Z(e){switch(e.key){case"ArrowRight":A();break;case"ArrowLeft":z();break;case"+":j();break;case"-":U();break}}function F(){let e=i[r];if(!e)return;let t=f.get(e.imgElt);return t?{x:t.translateX,y:t.translateY}:{x:0,y:0}}function B(e,t){let n=i[r];if(!n)return;let a=n.imgElt,s=f.get(a);!s||!a||(s.translateX=e,s.translateY=t,E(a))}function H(){v.innerHTML="",i.length=0,r=-1,l("previous"),l("next"),l("rotateLeft"),l("rotateRight"),l("zoomOut"),l("zoomReset"),l("zoomIn")}function D(e){return new Promise((t,n)=>{if(e.length===0){t();return}H();let a=e.length,s=null,h=()=>{a--,a<=0&&(p("upload"),p("open"),s?n(s):t())};for(let C of e){l("upload"),l("open");let o=document.createElement("img");L(o,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",userSelect:"none",position:"absolute"}),o.draggable=!1,f.set(o,{scale:1,rotation:0,translateX:0,translateY:0}),E(o);let u=new FileReader;u.onerror=()=>{u.onload=null,u.onabort=null,s=new Error("Failed to read a file's data."),h()},u.onabort=()=>{u.onload=null,u.onerror=null,h()},u.onload=x=>{u.onerror=null,u.onabort=null,o.src=x.target.result,o.onload=h,o.onabort=h,o.onerror=()=>{o.onload=null,o.onabort=null,s=new Error("Failed to load a file. Are you sure this is an image?"),h(),o.remove();for(let b=0;b<i.length;b++)i[b].imgElt===o&&(i.splice(b,1),b!==r||(r>=i.length&&(r=0),Y()),I())},v.appendChild(o),i.push({imgElt:o,filename:C.name}),r===-1?(r=0,p("rotateLeft"),p("rotateRight")):(p("previous"),p("next")),Y(),I()},u.readAsDataURL(C)}})}function U(){let e=i[r];if(!e)return;let t=e.imgElt,n=f.get(t);n&&(n.scale=Math.max(.1,n.scale-.1),E(t))}function j(){let e=i[r];if(!e)return;let t=e.imgElt,n=f.get(t);n&&(n.scale=Math.min(10,n.scale+.1),E(t))}function $(){let e=i[r];if(!e)return;let t=e.imgElt,n=f.get(t);n&&(n.scale=1,E(t))}function I(){let e=document.createElement("div");if(M.innerHTML="",i.length===0)e.textContent="No image loaded",M.appendChild(e);else{e.textContent=`Image ${r+1} / ${i.length}`;let t=document.createElement("div"),n=i[r]?.filename??"Untitled";t.textContent=n,c.updateTitle(null,n+" - Image Viewer"),M.appendChild(e),M.appendChild(t)}}function V(){let e=i[r];if(!e)return;let t=e.imgElt,n=f.get(t);n&&(n.rotation=(n.rotation-90)%360,E(t))}function W(){let e=i[r];if(!e)return;let t=e.imgElt,n=f.get(t);n&&(n.rotation=(n.rotation+90)%360,E(t))}function E(e){let t=f.get(e);t&&(e.style.transform=`translate(${t.translateX}px, ${t.translateY}px) scale(${t.scale}) rotate(${t.rotation}deg)`,t.scale===1?l("zoomReset"):p("zoomReset"),t.scale<=.1?l("zoomOut"):p("zoomOut"),t.scale>=10?l("zoomIn"):p("zoomIn"))}function N(e){let t=f.get(e);t&&(t.scale=1,t.rotation=0,t.translateX=0,t.translateY=0,E(e))}function z(){i.length<=1||(r=(r-1+i.length)%i.length,Y())}function Y(){if(y?.abort(),y=null,i.length===0){v.innerHTML="",r=-1;let e=document.createElement("div");e.innerHTML="No image loaded<br>Load one (or multiple) image(s) first.",L(e,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",color:c.STYLE.textColor,fontStyle:"italic"}),l("previous"),l("next"),l("rotateLeft"),l("rotateRight"),l("zoomOut"),l("zoomReset"),l("zoomIn"),v.appendChild(e)}else for(let e=0;e<i.length;e++)if(e===r){N(i[e].imgElt),y=new AbortController;let t=i[e].imgElt;t.style.display="block",re(y,w),ae(t,{getImagePosition:F,setImagePosition:B},y.signal)}else i[e].imgElt.style.display="none";I()}function A(){i.length<=1||(r=(r+1)%i.length,Y())}function q(){v.style.backgroundColor=c.STYLE.primaryColor}function K(){v.style.backgroundColor=c.STYLE.disabledColor}function G(e){return new Promise((t,n)=>{if(e.length===0){Y(),I(),t();return}H();let a=e.length,s=null,h=()=>{a--,a<=0&&(s?n(s):t())};for(let C of e){let o=document.createElement("img");L(o,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",userSelect:"none",position:"absolute"}),o.draggable=!1,f.set(o,{scale:1,rotation:0,translateX:0,translateY:0});let{filename:u,data:x}=C,b=se(u,x),Q=new Blob([x],{type:b}),_=URL.createObjectURL(Q);E(o),o.src=_,o.onload=h,o.onabort=h,o.onerror=()=>{s=new Error("Failed to load a file. Are you sure this is an image?"),URL.revokeObjectURL(_),h(),o.remove();for(let T=0;T<i.length;T++)i[T].imgElt===o&&(i.splice(T,1),T!==r||(r>=i.length&&(r=0),Y()),I())},v.appendChild(o),i.push({imgElt:o,filename:u}),r===-1?(r=0,p("rotateLeft"),p("rotateRight")):(p("previous"),p("next")),Y(),I()}})}function R(){X.style.display="flex",d.style.opacity=.5,d.setAttribute("inert",!0)}function k(){X.style.display="none",d.style.opacity=1,d.removeAttribute("inert")}function J(){let e={swipeStartX:0,swipeStartY:0,swipeStartTime:0,isSwipeGesture:!1,lastTouchDistance:0,lastTouchCenterX:0,lastTouchCenterY:0,isPinching:!1,isPanning:!1,panStartX:0,panStartY:0,panInitialImgX:0,panInitialImgY:0,initialPinchScale:1,initialPinchX:0,initialPinchY:0};m.addEventListener("touchstart",t=>{let n=i[r];if(n){if(t.touches.length===1){let a=t.touches[0];e.swipeStartX=a.clientX,e.swipeStartY=a.clientY,e.swipeStartTime=Date.now(),e.isSwipeGesture=!0,e.isPinching=!1,e.isPanning=!1,e.panStartX=a.clientX,e.panStartY=a.clientY;let s=F();s&&(e.panInitialImgX=s.x,e.panInitialImgY=s.y)}else if(t.touches.length===2){t.preventDefault();let a=t.touches[0],s=t.touches[1],h=Math.sqrt(Math.pow(s.clientX-a.clientX,2)+Math.pow(s.clientY-a.clientY,2)),C=(a.clientX+s.clientX)/2,o=(a.clientY+s.clientY)/2;e.lastTouchDistance=h,e.lastTouchCenterX=C,e.lastTouchCenterY=o,e.isPinching=!0,e.isSwipeGesture=!1,e.isPanning=!1;let u=f.get(n.imgElt);u&&(e.initialPinchScale=u.scale,e.initialPinchX=u.translateX,e.initialPinchY=u.translateY)}}},{passive:!1}),m.addEventListener("touchmove",t=>{let n=i[r];if(n){if(t.touches.length===2&&e.isPinching){t.preventDefault();let a=t.touches[0],s=t.touches[1],C=Math.sqrt(Math.pow(s.clientX-a.clientX,2)+Math.pow(s.clientY-a.clientY,2))/e.lastTouchDistance,o=f.get(n.imgElt);if(o){let u=Math.max(.1,Math.min(10,e.initialPinchScale*C));o.scale=u,E(n.imgElt)}}else if(t.touches.length===1){let a=t.touches[0],s=a.clientX-e.swipeStartX,h=a.clientY-e.swipeStartY,C=Math.abs(s),o=Math.abs(h),u=f.get(n.imgElt),x=u&&u.scale>1.1;!e.isPanning&&e.isSwipeGesture&&(x&&o>10?(e.isSwipeGesture=!1,e.isPanning=!0):!x&&C>20&&C>o||(C>10||o>10)&&(x||o>C)&&(e.isSwipeGesture=!1,e.isPanning=!0)),e.isPanning?(t.preventDefault(),B(e.panInitialImgX+a.clientX-e.panStartX,e.panInitialImgY+a.clientY-e.panStartY)):e.isSwipeGesture&&o>C&&o>30&&(e.isSwipeGesture=!1)}}},{passive:!1}),m.addEventListener("touchend",t=>{if(i[r]){if(e.isSwipeGesture&&t.changedTouches.length===1){let a=t.changedTouches[0],s=a.clientX-e.swipeStartX,h=a.clientY-e.swipeStartY,C=Date.now()-e.swipeStartTime,o=50,u=500,x=Math.abs(s),b=Math.abs(h);x>o&&x>b&&C<u&&(s>0?z():A())}e.isPinching=!1,e.isSwipeGesture=!1,e.isPanning=!1}},{passive:!1})}}function ae(g,{getImagePosition:c,setImagePosition:w},S){let d=0,X=0,y=0,i=0,r=!1;g.style.cursor="grab";let f=m=>{if(m.button!==0)return;m.preventDefault(),r=!0,d=m.clientX,X=m.clientY;let{x:v,y:M}=c();y=v,i=M,g.style.cursor="grabbing"},O=m=>{r&&w(y+m.clientX-d,i+m.clientY-X)},p=()=>{r&&(r=!1,g.style.cursor="grab")},l=m=>m.preventDefault();g.addEventListener("mousedown",f),g.addEventListener("selectstart",l),document.addEventListener("mousemove",O),document.addEventListener("mouseup",p),S.addEventListener("abort",()=>{g.removeEventListener("mousedown",f),g.removeEventListener("selectstart",l),document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",p)})}function P(g,c,w=5e3){let S=document.createElement("div");S.textContent=c,L(S,{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"10px 20px",borderRadius:"4px",zIndex:"1000",transition:"opacity 0.3s",textAlign:"center"}),g.appendChild(S),setTimeout(()=>{S.style.opacity="0",setTimeout(()=>{S.remove()},350)},w)}function re(g,c){let w=()=>g.abort();c.addEventListener("abort",w),g.signal.addEventListener("abort",()=>{c.removeEventListener("abort",w)})}function se(g,c){let w=new Uint8Array(c.slice(0,4));switch(Array.from(w).map(d=>d.toString(16).padStart(2,"0")).join("").toUpperCase()){case"89504E47":return"image/png";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"47494638":return"image/gif";case"52494646":return"image/webp";case"49492A00":case"4D4D002A":return"image/tiff";default:{let d=le(g);return d?d==="svg"?"image/svg+xml":d==="ico"?"image/x-icon":`image/${d}`:"application/octet-stream"}}}function le(g){let c=g.lastIndexOf(".");return c===-1?"":g.slice(c+1).toLowerCase()}function L(g,c){for(let w of Object.keys(c))g.style[w]=c[w]}function ce(){let g=document.createElement("div");L(g,{display:"none",position:"absolute",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",zIndex:"9999"});let c=document.createElement("div");return c.className="spinner",g.appendChild(c),g}export{ge as create};
