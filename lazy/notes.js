/** This is the code for the app identified as "notes". */
var $=new TextDecoder,w=2;function j(f,t){let{constructAppHeaderLine:E}=t.appUtils,d=document.createElement("div"),y=null,L=null,r=[],c=-1,p=null;k(d,{position:"relative",height:"100%",overflow:"hidden",width:"100%"});let T=_();d.appendChild(T);let F=document.createElement("div");k(F,{width:"100%",height:"100%",display:"flex",flexDirection:"column"});let{element:U,enableButton:m,disableButton:i}=E([{name:"upload",onClick:K},...t.filePickerOpen?[{name:"open",onClick:O}]:[],{name:"separator"},{name:"undo",onClick:I},{name:"redo",onClick:q},{name:"clear",onClick:()=>{let e=n.value;l.textContent="Cleared",n.value="",i("clear"),e&&h(!1),C()}},{name:"separator"},{name:"download",onClick:()=>{if(typeof window.showSaveFilePicker=="function")W(n.value);else{let e=document.createElement("a");e.download="notes.txt",e.href="data:text/plain;charset=utf-8,"+encodeURIComponent(n.value),e.click()}}},...t.quickSave?[{name:"quick-save",onClick:P}]:[],...t.filePickerSave?[{name:"save",onClick:M}]:[]]);i("undo"),i("redo"),i("clear"),i("quick-save");let a=document.createElement("div");a.style.position="relative",a.style.display="flex",a.style.flex="1",a.style.overflow="hidden";let S=document.createElement("pre");k(S,{backgroundColor:t.STYLE.bgColor,color:t.STYLE.textColor,minWidth:"40px",overflow:"hidden",textAlign:"right",padding:"8px 4px",fontFamily:"monospace",borderRight:"2px solid "+t.STYLE.lineColor,userSelect:"none"});let n=document.createElement("textarea");k(n,{flex:"1",backgroundColor:t.STYLE.bgColor,color:t.STYLE.textColor,border:"none",outline:"none",padding:"8px",resize:"none",fontFamily:"monospace",fontSize:t.STYLE.fontSize,whiteSpace:"pre",overflow:"auto"}),a.appendChild(S),a.appendChild(n);let l=document.createElement("div");k(l,{backgroundColor:t.STYLE.barBg,borderTop:"1px solid "+t.STYLE.lineColor,padding:"4px",bottom:"0",width:"100%",fontSize:t.STYLE.fontSize}),l.textContent="Ready",F.append(U,a,l),h(!1);let z=0,b;n.addEventListener("input",A),n.addEventListener("change",A);function A(){l.textContent="Writing...",n.value===""?i("clear"):m("clear"),b!==void 0?(clearTimeout(b),h(!0)):h(!1),b=setTimeout(()=>{l.textContent="Ready",b=void 0,h(!0)},500),C()}n.addEventListener("scroll",()=>B()),C();for(let e of f)if(e.type==="file"){R(e);break}return d.appendChild(F),{element:d,onActivate:()=>{document.addEventListener("keydown",N),n.focus({preventScroll:!0})},onDeactivate:()=>{document.removeEventListener("keydown",N)}};function R(e){try{let o=$.decode(e.data);n.value=o}catch(o){u(a,"\u274C Failed to load file:"+o.toString(),7e3);return}n.scrollTo(0,0),y=e.handle??null,r.length=0,c=-1,p=null,D(e.filename),C(),h(!1),i("undo"),i("redo"),i("clear"),i("quick-save")}function x(){v(),l.textContent="Ready",n.value="",r.length=0,c=-1,p=null,D(null),i("undo"),i("redo"),i("clear"),i("quick-save"),n.scrollTo(0,0),C(),h(!1)}function C(){let o=n.value.split(`
`).length||1;if(o!==z){z=o;let s="";for(let g=1;g<=o;g++)s+=`${g}
`;S.textContent=s}B()}function B(){S.scrollTop=n.scrollTop}function h(e){let o=n.value;if(o!==p){if(!e||r.length===0)for(c<r.length-1&&(r=r.slice(0,c+1)),r.push(o),c=r.length-1,p=o;r.length>100;)r.shift(),c--;else r[r.length-1]=o,p=o;i("redo"),c>0&&m("undo"),y&&m("quick-save")}}function I(){c<=0||(c--,n.value=r[c],p=n.value,l.textContent="Undo",c<r.length-1&&m("redo"),c<=0&&i("undo"),n.value===""?i("clear"):m("clear"),y&&m("quick-save"),C())}function q(){c>=r.length-1||(c++,n.value=r[c],p=n.value,l.textContent="Redo",c>0&&m("undo"),c>=r.length-1&&i("redo"),n.value===""?i("clear"):m("clear"),y&&m("quick-save"),C())}async function W(e){try{let o=await window.showSaveFilePicker({suggestedName:"notes.txt"}),s=await o.createWritable();return await s.write(e),await s.close(),o}catch(o){console.error(o)}}function D(e){e==null?(L=null,t.updateTitle(null,"Notes")):(L=e,t.updateTitle(null,String(e)+" - Notes"))}async function M(){Y(),l.textContent="Saving file...";try{let o=new TextEncoder().encode(n.value).buffer,s=await t.filePickerSave({title:"Choose where to save your (beautiful) note",savedFileData:o,savedFileName:L??"new_note.txt"});if(!s){v(),l.textContent="Ready";return}if(y=s?.handle??null,v(),l.textContent="Ready",!s){i("quick-save");return}D(s.filename)}catch(e){v(),l.textContent="Ready",u(a,"\u274C "+e.toString(),7e3)}i("quick-save")}async function P(){if(!y){u(a,"\u274C Cannot quick save: unknown file path.",5e3);return}l.textContent="Saving file...";try{let o=new TextEncoder().encode(n.value).buffer;await t.quickSave(y,o),i("quick-save"),l.textContent="Ready"}catch(e){l.textContent="Ready",u(a,"\u274C "+e.toString(),7e3)}}function N(e){switch(e.key){case"S":case"s":e.ctrlKey&&(e.preventDefault(),y?P():t.filePickerSave&&M());break;case"Z":case"z":e.ctrlKey&&(e.preventDefault(),e.shiftKey?q():I());break;case"Y":case"y":e.ctrlKey&&(e.preventDefault(),q());break}}function Y(){T.style.display="flex",d.style.opacity=.5,d.setAttribute("inert",!0)}function v(){T.style.display="none",d.style.opacity=1,d.removeAttribute("inert")}function K(){Y(),l.textContent="Loading file...";let e=document.createElement("input");e.type="file",e.accept="text/plain",e.multiple=!1,e.click(),e.addEventListener("cancel",async()=>{v(),l.textContent="Ready"}),e.addEventListener("error",async()=>{v(),u(a,"\u274C Failed to open your file-picker",5e3)}),e.addEventListener("change",async o=>{let s=o.target.files;if(s.length===0){x();return}try{if(s[0].size>w*1e6){x(),u(a,`\u274C File too big, there's a limit for now to ${w} MB maximum.`,7e3);return}let g=await s[0].arrayBuffer();if(g.byteLength>w*1e6){x(),u(a,`\u274C File too big, there's a limit for now to ${w} MB maximum.`,7e3);return}R({data:g,filename:s[0].name})}catch(g){x(),u(a,"\u274C "+g.toString(),7e3)}v(),l.textContent="Ready",p=null,h(!1)})}function O(){Y(),l.textContent="Loading file...",t.filePickerOpen({title:"Open a text file stored on this Web Desktop",allowMultipleSelections:!1}).then(e=>{if(e.length===0){x();return}if(e[0].data.byteLength>w*1e6){x(),u(a,`\u274C File too big, there's a limit for now to ${w} MB maximum.`,7e3);return}try{R(e[0])}catch(o){x(),u(a,"\u274C "+o.toString(),7e3)}v(),l.textContent="Ready",p=null,h(!1)},e=>{x(),u(a,"\u274C "+e.toString(),7e3)})}}function k(f,t){for(let E of Object.keys(t))f.style[E]=t[E]}function u(f,t,E=5e3){let d=document.createElement("div");d.textContent=t,k(d,{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"10px 20px",borderRadius:"4px",zIndex:"1000",transition:"opacity 0.3s",textAlign:"center"}),f.appendChild(d),setTimeout(()=>{d.style.opacity="0",setTimeout(()=>{d.remove()},350)},E)}function _(){let f=document.createElement("div");k(f,{display:"none",position:"absolute",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",zIndex:"9999"});let t=document.createElement("div");return t.className="spinner",f.appendChild(t),f}export{j as create};
