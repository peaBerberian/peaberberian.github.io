/** This is the code for the app identified as "paint". */
function w(s,o){for(let g of Object.keys(o))s.style[g]=o[g]}function se(s,{minHeight:o,minWidth:g},{onStart:h,onResize:p,onEnd:x},c){for(let E of["e","s","se"]){let v=document.createElement("div");w(v,{position:"absolute",zIndex:"300"}),E==="e"?w(v,{right:"-3px",bottom:"3px",width:"6px",height:"calc(100% - 5px)",cursor:"ew-resize"}):E==="s"?w(v,{bottom:"-3px",right:"5px",height:"6px",width:"calc(100% - 5px)",cursor:"ns-resize"}):E==="se"&&w(v,{bottom:"-3px",right:"-3px",height:"10px",width:"10px",cursor:"nwse-resize"}),s.appendChild(v),d(v,E)}function d(E,v){let D,H,k,y;Ve(E,"mousedown",c,M=>{if(M.button)return;s.classList.add("resizing"),h(),M.stopPropagation(),M.preventDefault(),D=M.clientX,H=M.clientY;let b=s.getBoundingClientRect();k=b.width,y=b.height,document.addEventListener("mousemove",A),document.addEventListener("mouseup",u),document.addEventListener("click",u),document.addEventListener("resize",u)});let u=()=>{x(),s.classList.remove("resizing"),document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",u),document.removeEventListener("click",u),document.removeEventListener("resize",u)},A=M=>{requestAnimationFrame(()=>{let b=M.clientX-D,S=M.clientY-H,f,N;v.includes("e")&&(N=Math.max(g,k+b)),v.includes("s")&&(f=Math.max(o,y+S)),p({newHeight:f,newWidth:N})})}}}function Ve(s,o,g,h){s.addEventListener(o,h),g.addEventListener("abort",()=>{s.removeEventListener(o,h)})}var Ee=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 47.375 47.375" xml:space="preserve">
<g>
  <path d="M44.538,10.909l-8.616-8.642C34.465,0.805,32.526,0,30.461,0c-2.055,0-3.986,0.799-5.441,2.251L2.851,24.377   c-1.457,1.455-2.263,3.391-2.265,5.447c-0.004,2.062,0.797,3.998,2.252,5.451l8.617,8.644c1.455,1.462,3.396,2.269,5.459,2.269   c2.056,0,3.986-0.799,5.443-2.252L44.523,21.81c1.457-1.454,2.262-3.388,2.266-5.447C46.792,14.302,45.991,12.364,44.538,10.909z    M17.413,38.98c-0.17,0.17-0.365,0.207-0.498,0.207c-0.135,0-0.33-0.037-0.502-0.209l-8.621-8.646   c-0.17-0.17-0.205-0.363-0.205-0.498c0-0.134,0.037-0.331,0.209-0.502l6.031-6.02l9.619,9.646L17.413,38.98z M33.45,44.154   c0,1.779-1.441,3.221-3.221,3.221c-0.713,0-1.363-0.238-1.898-0.629c-0.314,0.381-0.787,0.629-1.322,0.629   c-0.447,0-0.852-0.176-1.156-0.454c-0.233,0.272-0.567,0.454-0.953,0.454c-0.704,0-1.271-0.568-1.271-1.27   c0-0.703,0.566-1.271,1.271-1.271c0.188,0,0.367,0.048,0.527,0.124c0.268-0.61,0.873-1.037,1.582-1.037   c0.01,0,0.016,0.002,0.023,0.002c0.119-1.669,1.498-2.989,3.197-2.989C32.008,40.934,33.45,42.375,33.45,44.154z M36.051,46.059   c0,0.728-0.59,1.315-1.315,1.315c-0.727,0-1.316-0.589-1.316-1.315c0-0.728,0.59-1.315,1.316-1.315   C35.461,44.743,36.051,45.332,36.051,46.059z"/>
</g>
</svg>`,be=`<svg width="800px" height="800px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
<path d="M27.555 8.42c-1.355 1.647-5.070 6.195-8.021 9.81l-3.747-3.804c3.389-3.016 7.584-6.744 9.1-8.079 2.697-2.377 5.062-3.791 5.576-3.213 0.322 0.32-0.533 2.396-2.908 5.286zM18.879 19.030c-1.143 1.399-2.127 2.604-2.729 3.343l-4.436-4.323c0.719-0.64 1.916-1.705 3.304-2.939l3.861 3.919zM15.489 23.183v-0.012c-2.575 9.88-14.018 4.2-14.018 4.2s4.801 0.605 4.801-3.873c0-4.341 4.412-4.733 4.683-4.753l4.543 4.427c0 0.001-0.009 0.011-0.009 0.011z"/>
</svg>`,Ce=`<svg width="800px" height="800px" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
  <rect x="10" y="10" width="80" height="10" rx="5" transform="rotate(45 10 10)" />
</svg>`,Le='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 26.361 26.361" xml:space="preserve"><g><path d="M24.362,0H2C0.896,0,0,0.896,0,2v22.36c0,1.104,0.896,2.001,2,2.001h22.361c1.104,0,2-0.896,2-2.001V2   C26.362,0.896,25.467,0,24.362,0z M22.362,22.362H4V4h18.361L22.362,22.362L22.362,22.362z"/></g></svg>',ze='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800px" height="800px" viewBox="0 0 34.76 34.76" xml:space="preserve"><g><g><path d="M17.38,34.76c-9.583,0-17.379-7.796-17.379-17.38S7.797,0,17.38,0s17.379,7.796,17.379,17.38S26.963,34.76,17.38,34.76z     M17.38,6.495c-6.002,0-10.885,4.882-10.885,10.885s4.883,10.885,10.885,10.885s10.885-4.882,10.885-10.885    S23.382,6.495,17.38,6.495z"/></g></g></svg>',Ie='<svg width="200" height="100"><rect width="100%" height="100%" /></svg>',Me='<svg width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40"/></svg>',Te=`<svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M4 4 L28 16 L16 20 L12 28 Z"/>
    <!-- Optional white border for visibility on dark backgrounds -->
    <path d="M4 4 L28 16 L16 20 L12 28 Z" fill="none" stroke="white" stroke-width="0.5"/>
</svg>`,De='<svg width="800px" height="800px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M4,29.987l24,0c0.828,0 1.5,-0.672 1.5,-1.5c0,-0.827 -0.672,-1.5 -1.5,-1.5l-24,0c-0.828,0 -1.5,0.673 -1.5,1.5c0,0.828 0.672,1.5 1.5,1.5Z"/><path d="M9.138,22.244c1.323,0.328 2.775,0.118 3.995,-0.702l9.873,-6.712c0.458,-0.308 0.58,-0.929 0.273,-1.388l-6.717,-10c-0.308,-0.458 -0.929,-0.58 -1.388,-0.272c0,-0 -6.027,4.048 -9.961,6.691c-2.293,1.539 -2.903,4.646 -1.363,6.938c0.725,1.08 1.53,2.279 2.256,3.359c0.738,1.099 1.836,1.812 3.032,2.086Zm11.448,-9.223l-15.418,0c0.207,-0.591 0.599,-1.124 1.16,-1.5c-0,-0 9.131,-6.133 9.131,-6.133l5.127,7.633Z"/><path d="M26.339,15.455c-0.185,-0.284 -0.5,-0.455 -0.839,-0.455c-0.339,-0 -0.654,0.171 -0.839,0.455c0,0 -1.274,1.965 -2.039,3.732c-0.379,0.876 -0.622,1.717 -0.622,2.313c-0,1.932 1.568,3.5 3.5,3.5c1.932,0 3.5,-1.568 3.5,-3.5c-0,-0.596 -0.243,-1.437 -0.622,-2.313c-0.765,-1.767 -2.039,-3.732 -2.039,-3.732Z"/></svg>',Re='<svg fill="#000000" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="20px" width="20px" version="1.1" viewBox="0 0 334.312 334.312" xml:space="preserve"><g><g><circle cx="167.156" cy="167.155" r="13.921"/><path stroke="#ffffff" stroke-width="20" fill="#000000" d="M110.483,135.793c3.497,3.491,8.079,5.239,12.656,5.239s9.159-1.748,12.656-5.245    c6.993-6.987,6.993-18.324,0-25.317L30.556,5.244c-6.993-6.987-18.318-6.987-25.311,0s-6.993,18.324,0,25.317L110.483,135.793z"/><path stroke="#ffffff" stroke-width="20" fill="#000000" d="M211.173,141.038c4.583,0,9.159-1.748,12.656-5.239L329.067,30.561    c6.993-6.993,6.993-18.324,0-25.317c-6.993-6.993-18.318-6.987-25.311,0L198.518,110.475c-6.993,6.993-6.993,18.324,0,25.317    C202.014,139.289,206.591,141.038,211.173,141.038z"/><path stroke="#ffffff" stroke-width="20" fill="#000000" d="M303.755,329.066c3.497,3.491,8.079,5.239,12.656,5.239s9.159-1.748,12.656-5.245    c6.993-6.987,6.993-18.324,0-25.317L223.829,198.517c-6.993-6.987-18.318-6.987-25.311,0s-6.993,18.324,0,25.317L303.755,329.066z    "/><path stroke="#ffffff" stroke-width="20" fill="#000000" d="M17.901,334.311c4.583,0,9.159-1.748,12.656-5.239L135.794,223.84    c6.993-6.993,6.993-18.324,0-25.317s-18.318-6.987-25.311,0L5.245,303.748c-6.993,6.993-6.993,18.324,0,25.317    C8.741,332.562,13.324,334.311,17.901,334.311z"/></g></g></svg>';var qe=800,Fe=800;function ot(s,o,g){let{constructAppHeaderLine:h}=o.appUtils,p=0,x=0,c=0,d=0,E=!1,v="Brush",D="#000000",H=15,k=!1,y=!0,u=null,A=null,M=!1,b=[],S=0,f=document.createElement("div");w(f,{height:"100%",width:"100%",overflow:"hidden",display:"flex",flexDirection:"column"});let N=$e();f.appendChild(N);let{element:ce,enableButton:l,disableButton:C}=h([{name:"upload",onClick:He},...o.filePickerOpen?[{name:"open",onClick:Ne}]:[],{name:"separator"},{name:"undo",onClick:ve},{name:"redo",onClick:oe},{name:"clear",onClick:()=>{let e=k;fe(),e&&(y=!0,Q())}},{name:"separator"},{name:"download",onClick:Pe},...o.quickSave?[{name:"quick-save",onClick:we}]:[],...o.filePickerSave?[{name:"save",onClick:me}]:[]]);C("undo"),C("redo"),C("clear"),C("quick-save"),f.appendChild(ce);let G=document.createElement("div");w(G,{height:"100%",width:"100%",overflow:"hidden",display:"flex"}),f.appendChild(G);let X=document.createElement("div");w(X,{height:"100%",display:"flex",flexDirection:"column",backgroundColor:o.STYLE.barBg,borderRight:o.STYLE.lineColor,alignItems:"center",overflow:"auto",flexShrink:"0"}),G.appendChild(X);let Y=document.createElement("div");w(Y,{position:"relative",backgroundColor:o.STYLE.disabledColor,height:"100%",width:"100%",overflow:"auto"});let V=document.createElement("div");w(V,{width:String(Fe+30)+"px",height:String(qe+30)+"px",position:"relative"});let W=document.createElement("div");W.style.display="inline-block",W.style.position="relative";let i=document.createElement("canvas");w(i,{border:o.STYLE.lineColor,boxShadow:"0 0 15px rgba(0, 0, 0, 0.3)"}),W.appendChild(i),V.appendChild(W),se(W,{minHeight:100,minWidth:100},{onStart:()=>{A=r.getImageData(0,0,i.width,i.height),M=!0},onResize:({newHeight:e,newWidth:t})=>{window.requestAnimationFrame(()=>{e!==void 0&&(V.style.height=String(e+30)+"px",i.height=e),t!==void 0&&(V.style.width=String(t+30)+"px",i.width=t),fe(),A&&(r.fillStyle="white",r.fillRect(0,0,i.width,i.height),r.putImageData(A,0,0)),u?.handle&&l("quick-save")})},onEnd:()=>{M=!1}},g),Y.appendChild(V),G.appendChild(Y),i.width=String(Fe),i.height=String(qe);let r=i.getContext("2d",{willReadFrequently:!0});r.fillStyle="white",r.fillRect(0,0,i.width,i.height);let ne=[];function de(e,t){for(let n of ne)n===e?n.children[0].setAttribute("fill",o.STYLE.primaryColor):n.children[0].setAttribute("fill",o.STYLE.textColor);v=t,v==="Cursor (no tool)"?i.style.cursor="auto":i.style.cursor=`url("data:image/svg+xml;utf8,${encodeURIComponent(Re)}") 10 10, crosshair`}let ie=Ae([5,8,10,15,20,25,35],H,e=>{H=e});for(let[e,t,n]of[[be,"Brush",{heightScale:1,enableSizeSelection:!0}],[Ce,"Line",{heightScale:1,enableSizeSelection:!0}],[Le,"Rectangle Outline",{heightScale:.8,enableSizeSelection:!0}],[ze,"Circle Outline",{heightScale:.8,enableSizeSelection:!0}],[Ie,"Rectangle",{heightScale:.6,enableSizeSelection:!1}],[Me,"Circle",{heightScale:1,enableSizeSelection:!1}],[De,"Bucket",{heightScale:1,enableSizeSelection:!1}],[Ee,"Eraser",{heightScale:1,enableSizeSelection:!0}],[Te,"Cursor (no tool)",{heightScale:1,enableSizeSelection:!1}]]){let a=Ye(e,t,n.heightScale,()=>{de(a,t),n.enableSizeSelection?ie.style.display="block":ie.style.display="none"});ne.push(a),X.appendChild(a)}de(ne[0],"Brush");let _=document.createElement("input");return _.type="color",_.value="#000000",w(_,{width:"40px",height:"30px",minHeight:"30px",margin:"8px"}),_.addEventListener("change",e=>{D=e.target.value}),X.appendChild(_),X.appendChild(ie),Q(),f.addEventListener("mousedown",e=>{e.button===0&&v!=="Cursor (no tool)"&&(e.preventDefault(),ge(e),J(e))}),f.addEventListener("touchstart",e=>{if(v==="Cursor (no tool)")return;let t=e.touches[0];ge(t),J(t)},{passive:!0}),f.addEventListener("touchmove",e=>{if(e.touches.length===1){if(v==="Cursor (no tool)")return;let t=e.touches[0];J(t)}},{passive:!1}),W.addEventListener("touchmove",e=>{e.touches.length===1&&v!=="Cursor (no tool)"&&e.preventDefault()},{passive:!1}),f.onselectstart=e=>{e.preventDefault()},f.onmousemove=J,document.addEventListener("mouseup",F),document.addEventListener("click",F),document.addEventListener("touchend",F),document.addEventListener("touchcancel",F),g.addEventListener("abort",()=>{document.removeEventListener("mouseup",F),document.removeEventListener("click",F),document.removeEventListener("touchend",F),document.removeEventListener("touchcancel",F)}),{element:f,onActivate(){document.addEventListener("keydown",he)},onDeactivate(){document.removeEventListener("keydown",he)}};function ue({img:e,handle:t,name:n,type:a}){A=null,M=!1,u={handle:t??null,name:n??null,type:a??"image/png"},p=0,x=0,c=0,d=0,E=!1,k=!1,y=!0,b.length=0,S=0,C("undo"),C("redo"),C("clear"),C("quick-save"),n?o.updateTitle(null,n+" - Image Viewer"):o.updateTitle(null,"Image Viewer"),w(V,{width:String(e.width+30)+"px",height:String(e.height+30)+"px"}),i.width=e.width,i.height=e.height,r.clearRect(0,0,i.width,i.height),r.fillStyle="white",r.fillRect(0,0,i.width,i.height),r.drawImage(e,0,0)}function he(e){switch(e.key){case"S":case"s":e.ctrlKey&&(e.preventDefault(),u?.handle?we():o.filePickerSave&&me());break;case"Z":case"z":e.ctrlKey&&(e.preventDefault(),e.shiftKey?oe():ve());break;case"Y":case"y":e.ctrlKey&&(e.preventDefault(),oe());break}}function ge(e){E=!0,[p,x]=pe(i,e),[c,d]=[p,x]}function J(e){if(!E||M)return;let[t,n]=pe(i,e),a=t>0&&t<=i.width&&n>0&&n<=i.height&&!X.contains(e.target)&&!ce.contains(e.target);switch(r.lineJoin="round",r.lineCap="round",r.lineWidth=H,v){case"Brush":r.strokeStyle=D,r.beginPath(),r.moveTo(p,x),r.lineTo(t,n),r.stroke(),a&&(y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save"));break;case"Bucket":a&&Be(t,n,D)&&(y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save"));break;case"Eraser":r.strokeStyle="white",r.beginPath(),r.moveTo(p,x),r.lineTo(t,n),r.stroke(),a&&k&&(y=!0);break;case"Line":O(),r.strokeStyle=D,r.beginPath(),r.moveTo(c,d),r.lineTo(t,n),r.stroke(),a&&(y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save"));break;case"Rectangle":O(),r.fillStyle=D,r.fillRect(c,d,t-c,n-d),(c!==t||d!==n)&&(c>=0||t>=0)&&(d>=0||n>=0)&&(c<=i.width||t<=i.width)&&(d<=i.height||t<=i.height)&&(y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save"));break;case"Circle":if((c!==t||d!==n)&&(c>=0||t>=0)&&(d>=0||n>=0)&&(c<=i.width||t<=i.width)&&(d<=i.height||t<=i.height)){O(),r.fillStyle=D;let m=Math.sqrt(Math.pow(t-c,2)+Math.pow(n-d,2));r.beginPath(),r.arc(c,d,m,0,2*Math.PI),r.fill(),y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save")}break;case"Rectangle Outline":O(),r.strokeStyle=D,r.beginPath(),r.rect(c,d,t-c,n-d),r.stroke(),(c!==t||d!==n)&&(c>=0||t>=0)&&(d>=0||n>=0)&&(c<=i.width||t<=i.width)&&(d<=i.height||t<=i.height)&&(y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save"));break;case"Circle Outline":if((c!==t||d!==n)&&(c>=0||t>=0)&&(d>=0||n>=0)&&(c<=i.width||t<=i.width)&&(d<=i.height||t<=i.height)){O();let m=Math.sqrt(Math.pow(t-c,2)+Math.pow(n-d,2));r.strokeStyle=D,r.beginPath(),r.arc(c,d,m,0,2*Math.PI),r.stroke(),y=!0,k=!0,l("clear"),l("undo"),u?.handle&&l("quick-save")}break}(v==="Brush"||v==="Eraser")&&([p,x]=[t,n])}function F(){E&&(E=!1,Q())}function pe(e,t){let n=e.getBoundingClientRect();return[t.clientX-n.left,t.clientY-n.top]}function fe(){r.fillStyle="white",r.fillRect(0,0,i.width,i.height),k=!1,C("clear")}function Be(e,t,n){let a=i.width,m=i.height,L=r.getImageData(0,0,i.width,i.height),T=L.data,q=Math.min(Math.round(e),i.width-1),ee=Math.min(Math.round(t),i.height-1),Z=xe(L,a,q,ee),U=Ue(n);if(Se(Z,U))return!1;let ae=new Uint8Array(a*m),ke=[],j=[[q,ee]],ye=0;for(;ye<j.length;){let[z,I]=j[ye++],K=I*a+z;if(z<0||z>=a||I<0||I>=m||ae[K])continue;let $=xe(L,a,z,I);if(!Se($,Z))continue;ae[K]=1,ke.push([z,I]);let B=(I*a+z)*4;T[B]=U.r,T[B+1]=U.g,T[B+2]=U.b,z+1<a&&j.push([z+1,I]),z-1>=0&&j.push([z-1,I]),I+1<m&&j.push([z,I+1]),I-1>=0&&j.push([z,I-1])}for(let[z,I]of ke)for(let K=-1;K<=1;K++)for(let $=-1;$<=1;$++){let B=z+$,te=I+K;if(B<0||B>=a||te<0||te>=m)continue;let Xe=te*a+B;if(!ae[Xe]){let le=(te*a+B)*4;T[le]=U.r,T[le+1]=U.g,T[le+2]=U.b}}return r.putImageData(L,0,0),!0}function Pe(){if(typeof window.showSaveFilePicker=="function"&&typeof i.toBlob=="function")i.toBlob(e=>{Oe(e)},"image/png");else{let e=document.createElement("a");e.download="painting.png",e.href=i.toDataURL("image/png"),e.click()}}function me(){re(),i.toBlob(async e=>{try{let t=await e.arrayBuffer(),n=await o.filePickerSave({title:"Choose where to save your (magnificient \u{1F44C}) painting",savedFileData:t,savedFileName:u?.name??"painting.png"});if(!n){R();return}u={handle:n.handle??null,name:n.filename??null},n.filename?o.updateTitle(null,n.filename+" - Image Viewer"):o.updateTitle(null,"Image Viewer"),C("quick-save")}catch(t){P(f,"\u274C "+t.toString(),1e4)}R()},u?.type??"image/png")}function we(){Q(),i.toBlob(async e=>{try{let t=await e.arrayBuffer();if(!u?.handle){P(f,"\u274C Cannot quick save: unknown file path.",5e3);return}await o.quickSave(u.handle,t),y?l("quick-save"):C("quick-save")}catch(t){P(f,"\u274C "+t.toString(),1e4)}})}function Q(){if(!y)return;u?.handle&&l("quick-save"),y=!1;let e=r.getImageData(0,0,i.width,i.height);for(S!==b.length&&(b.splice(S),C("redo")),b.push([e,k]),S++,S>1&&l("undo");b.length>20;)b.shift(),S--}function O(){if(S>0){let[e,t]=b[S-1];r.fillStyle="white",r.fillRect(0,0,i.width,i.height),r.putImageData(e,0,0),k=t,k?l("clear"):C("clear"),u?.handle&&l("quick-save")}}function ve(){S>1&&(S--,O(),S<=1&&C("undo"),S<b.length&&l("redo"))}function oe(){S<b.length&&(S++,O(),S>1&&l("undo"),S>=b.length&&C("redo"))}function Ae(e,t,n){let a=document.createElement("div");a.className="size-selector",w(a,{padding:"12px 5px",background:o.STYLE.bgColor,border:"5px solid "+o.STYLE.lineColor});let m=document.createElement("div");m.className="size-options",w(m,{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"}),a.appendChild(m);let L=[];for(let T of e){let q=document.createElement("button");q.className="size-option",q.title=`${T}px`,m.appendChild(q),w(q,{width:T+"px",height:T+"px",borderRadius:"50%",border:"1px solid "+o.STYLE.lineColor,background:T===t?o.STYLE.primaryColor:o.STYLE.textColor,cursor:"pointer",transition:"transform 0.1s"}),L.push(q);let ee=()=>{for(let Z of L)Z===q?Z.style.background=o.STYLE.primaryColor:Z.style.background=o.STYLE.textColor;n(T)};q.onclick=ee}return a}function Ye(e,t,n,a){let m=We(e);w(m,{width:"2rem",height:`${n*2}rem`,minHeight:`${n*2}rem`,margin:"10px",overflow:"visible"});let L=document.createElement("span");return L.style.margin="0 auto",L.style.cursor="pointer",L.appendChild(m),L.onclick=a,L.title=t,L}async function Oe(e){try{let t=await window.showSaveFilePicker({suggestedName:"painting.png",types:[{description:"Image",accept:{"image/png":[".png"]}}]}),n=await t.createWritable();return await n.write(e),await n.close(),t}catch(t){console.error(t)}}function xe(e,t,n,a){let m=(a*t+n)*4;return{r:e.data[m],g:e.data[m+1],b:e.data[m+2]}}function Se(e,t,n=10){return Math.abs(e.r-t.r)<=n&&Math.abs(e.g-t.g)<=n&&Math.abs(e.b-t.b)<=n}function Ue(e){e=e.replace("#","");let t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),a=parseInt(e.substring(4,6),16);return{r:t,g:n,b:a}}function re(){N.style.display="flex",f.style.opacity=.5,f.setAttribute("inert",!0)}function R(){N.style.display="none",f.style.opacity=1,f.removeAttribute("inert")}function He(){re();let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!1,e.click(),e.addEventListener("error",()=>{R(),P(Y,"\u274C Failed to open your file-picker",5e3)}),e.addEventListener("cancel",()=>{R()}),e.addEventListener("change",t=>{let n=t.target.files;if(!n[0]){R();return}Ze(n[0]).then(a=>{ue({img:a,name:n[0].name,type:n[0].type}),R()}).catch(a=>{R(),P(Y,"\u274C "+a.toString(),5e3)})})}function Ne(){re(),o.filePickerOpen({title:"Open an image from files stored on this Web Desktop",allowMultipleSelections:!1}).then(e=>{if(!e||!e[0]){R();return}je(e[0]).then(({img:t,mimeType:n})=>{ue({img:t,handle:e[0].handle,name:e[0].filename,type:n}),R()}).catch(t=>{R(),P(Y,"\u274C "+t.toString(),5e3)})},e=>{R(),P(Y,"\u274C "+e.toString(),1e4)})}}function We(s){let o=document.createElement("div");return o.innerHTML=s,o.children[0]}function P(s,o,g=5e3){let h=document.createElement("div");h.textContent=o,w(h,{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"10px 20px",borderRadius:"4px",zIndex:"1000",transition:"opacity 0.3s",textAlign:"center"}),s.appendChild(h),setTimeout(()=>{h.style.opacity="0",setTimeout(()=>{h.remove()},350)},g)}function Ze(s){return s.type.match("image.*")?new Promise((o,g)=>{let h=new FileReader;h.onload=function(p){let x=new Image;x.onload=function(){o(x)},x.onerror=function(){g(new Error("Error loading this image. Try a different file."))},x.src=p.target.result},h.onerror=function(){g(new Error("Error reading this file"))},h.readAsDataURL(s)}):(P(messageContainerElt,"\u274C "+err.toString(),1e4),Promise.reject(new Error("This is not a recognized image format.")))}function je(s){return new Promise((o,g)=>{try{let{filename:h,data:p}=s,x=new Image,c=Ke(h,p),d=new Blob([p],{type:c}),E=URL.createObjectURL(d);x.src=E,x.onload=function(){o({img:x,mimeType:c})},x.onerror=()=>{URL.revokeObjectURL(E),g(new Error("Failed to load a file. Are you sure this is an image?"))}}catch(h){g(h)}})}function Ke(s,o){let g=new Uint8Array(o.slice(0,4));switch(Array.from(g).map(p=>p.toString(16).padStart(2,"0")).join("").toUpperCase()){case"89504E47":return"image/png";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"47494638":return"image/gif";case"52494646":return"image/webp";case"49492A00":case"4D4D002A":return"image/tiff";default:{let p=_e(s);return p?p==="svg"?"image/svg+xml":p==="ico"?"image/x-icon":`image/${p}`:"application/octet-stream"}}}function _e(s){let o=s.lastIndexOf(".");return o===-1?"":s.slice(o+1).toLowerCase()}function $e(){let s=document.createElement("div");w(s,{display:"none",position:"absolute",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",zIndex:"9999"});let o=document.createElement("div");return o.className="spinner",s.appendChild(o),s}export{ot as create};
