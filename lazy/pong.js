/** This is the code for the app identified as "pong". */
function S(f,i,l){let s=document.createElement("div");I(s,{backgroundColor:i.STYLE.windowActiveHeader,color:i.STYLE.windowActiveHeaderText,height:"100%",width:"100%",overflowY:"auto",margin:"0",padding:"0",overflow:"hidden"});let h,E=null,v=new ResizeObserver(o=>{for(let t of o)t.contentRect&&(E!==null&&clearTimeout(E),E=setTimeout(()=>{E=null,s.innerHTML="",w(t.contentRect)},50))});v.observe(s),l.addEventListener("abort",()=>{v.unobserve(s)});let n,D=!1,a,m=!1,H=!1;return w(s.getBoundingClientRect()),s.addEventListener("mousemove",k,{passive:!1}),s.addEventListener("touchmove",_,{passive:!1}),s.onselectstart=o=>o.preventDefault(),{element:s,onActivate:()=>{document.addEventListener("keydown",A),document.addEventListener("keyup",P)},onDeactivate:()=>{document.removeEventListener("keydown",A),document.removeEventListener("keyup",P),m=!1,H=!1}};function w(o){s.innerHTML="",o.width>0&&o.height>0?s.appendChild(M(o)):h!==void 0&&(window.cancelAnimationFrame(h),h=void 0)}function A(o){switch(o.key){case"ArrowUp":m=!0;break;case"ArrowDown":H=!0;break;case" ":D=!0;break}}function P(o){switch(o.key){case"ArrowUp":m=!1;break;case"ArrowDown":H=!1;break}}function _(o){if(o.touches.length===1){let t=o.touches[0],e=s.getBoundingClientRect(),r=t.clientY-e.top;a.y=Math.max(0,Math.min(r-80/2,n.height-80))}}function k(o){let t=n.getBoundingClientRect(),e=o.clientY-t.top;a.y=Math.max(0,Math.min(e-80/2,n.height-80))}function M(o){h!==void 0&&(window.cancelAnimationFrame(h),h=void 0),n=document.createElement("canvas"),n.width=o.width,n.height=o.height,I(n,{height:"100%",width:"100%",backgroundColor:i.STYLE.windowActiveHeader});let t=n.getContext("2d"),e={x:n.width/2,y:n.height/2,radius:10,dx:5,dy:5,prevX:n.width/2,prevY:n.height/2},r={x:0,y:n.height/2-80/2};a={x:n.width-10,y:n.height/2-80/2},D=!1;let u=0,y=0,c=8;return L(!1,!1),n.addEventListener("click",()=>{D=!0}),x(),n;function x(){if(m?a.y=Math.max(0,a.y-5):H&&(a.y=Math.min(n.height-80,a.y+5)),!D){L(!1,!1),t.font="32px monospace",t.fillText("Click to start a game",10,50),h=window.requestAnimationFrame(x);return}L(!0,!0);let d=r.y+80/2;d<e.y-20?r.y+=Math.min(12,e.y-d,c):d>e.y+20?r.y-=Math.min(12,d-e.y,c):d<e.y-10?r.y+=Math.min(7,e.y-d,c):d>e.y+10?r.y-=Math.min(7,d-e.y,c):d<e.y-5?r.y+=1:d>e.y+5&&(r.y-=1),r.y=Math.max(0,Math.min(r.y,n.height-80)),e.prevX=e.x,e.prevY=e.y,e.x+=e.dx,e.y+=e.dy,(e.y+e.radius>n.height||e.y-e.radius<0)&&(e.dy=-e.dy),e.dx<0?p(r,e):e.dx>0&&p(a,e)&&(y-u>3?c=12:y-u>=2?c=T(10,12):y-u<-3?c=4:y-u<=-2?c=T(4,8):y-u<=-1?c=T(8,11):c=T(6,10)),e.x+e.radius>n.width?(u++,g()):e.x-e.radius<0&&(e.dx=5,y++,g()),h=requestAnimationFrame(x)}function L(d,G){if(t.clearRect(0,0,n.width,n.height),G&&(t.setLineDash([10,5]),t.beginPath(),t.moveTo(n.width/2,0),t.lineTo(n.width/2,n.height),t.strokeStyle="#ffffff",t.lineWidth=3,t.stroke(),t.setLineDash([])),d&&(t.font="32px monospace",t.fillText(u,n.width/4,50),t.fillText(y,3*n.width/4,50)),t.lineWidth=1,t.beginPath(),t.arc(e.x,e.y,e.radius,0,Math.PI*2),t.fillStyle="#ffffff",t.strokeStyle="#000000",t.fill(),t.stroke(),t.closePath(),t.fillStyle="#ffffff",t.strokeStyle="#000000",!D){t.font="22px monospace",t.fillText("Bot",r.x+10+8,r.y+80);let R=t.measureText("You");t.fillText("You",a.x-10-5-R.width,a.y+80)}t.fillRect(r.x,r.y,10,80),t.strokeRect(r.x,r.y,10,80),t.fillRect(a.x,a.y,10,80),t.strokeRect(a.x,a.y,10,80)}function g(){c=8,e.x=n.width/2,e.y=n.height/2,e.prevX=e.x,e.prevY=e.y,e.dx=e.dx<0?5:-5,e.dy=Math.random()*8-4}}}function p(f,i){let l=(f.x-i.prevX+(i.dx>0?-i.radius:10+i.radius))/i.dx;if(l<0||l>1)return;let s=i.prevY+i.dy*l;if(s+i.radius>f.y&&s-i.radius<f.y+80){i.x=i.prevX+i.dx*l,i.y=s,i.dx=-i.dx*1.05;let h=f.y+80/2;return i.dy+=(i.y-h)*.1,!0}return!1}function T(f,i){return Math.floor(Math.random()*(i-f+1))+f}function I(f,i){for(let l of Object.keys(i))f.style[l]=i[l]}export{S as create};
